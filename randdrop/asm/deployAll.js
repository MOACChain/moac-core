/* Script to create a MOAC RandDrop ASM AppChain using precompiled contracts.
 * The source file of the contracts are in the folder.
 * Require:
 * 1. Valid account with enough moac to deploy the contracts;
 * 2. A running VNODE can connect and send Transaction to, need turn on personal in rpc api;
 --rpcapi "chain3,mc,net,vnode,personal,
 * 3. At least three SCSs, recommended 5;
 * 4. A VNODE used as proxy for the AppChain, with VNODE settings in the vnodeconfig.json;
 * 5. 4 contract files:
 *    VnodeProtocolBase.sol
 *    SCSProtocolBase.sol
 *    VssBase.sol
 *    RanddropChainBaseASM.sol
 * 
 * Steps:
 * 1. Deploy the pre requied contracts, include the VNODE pool, SCS pool, and  
 *    VSS contracts. If using the existing pools, need to obtain
 *    existing pool's address;
 * 2. Deploy the AppChain contract using VNODE pool, SCS pool and VSS contract addresses;
 * 3. Call VSS setCaller method with AppChain address as input to only allow the AppChain 
 *    access the VSS method;
 * 4. Register the VNODE, SCSs, then open AppChain to get all the SCSs registered.
 * 5. Closed the registration and started the AppChain.
 *  
 * Further Readings:
 * This script generates a AppChain with DAPPBase on it.
 * To deploy DAPP contracts on AppChain, check deployDappBase.js
 * To call the AppChain functions and Dapp functions, please check callDappExample.js.
 * 
 * For AppChain related info, please check online documents:
 * English:
 * https://moac-docs.readthedocs.io/en/latest
 * 中文：
 * https://moacdocs-chn.readthedocs.io/zh_CN/latest
 * 
*/


// only 0.4.24 or 0.4.26 version should be used, 
// To install a certain version of solc: npm install solc@0.4.24
const solc = require('solc');
const Chain3 = require('chain3');
const fs = require('fs');

//===============Setup the Parameters==========================================

// need to have a valid account to use for contracts deployment
var baseaddr = "";//keystore address
var basepsd = "";//keystore password

// The known SCS on MOAC network
var scs=["",
         "",
         "",
        ]

// Choose the right DappBase contract 
// DappBasePublic.sol allows other users to deploy the Dapp on the AppChain
// DappBasePrivate.sol only allows the owner
var inDappFile = "DappBasePublic.sol";//


var VNODEVia="";// The VNODE benificial address, should be found in the vnodeconfig.json 
var vnodeConnectUrl="127.0.0.1:50062";//VNODE connection as parameter to use for VNODE pool protocol
var minScsRequired = 3; // Min number of SCSs in the AppChain, recommended 3 or more


//2020/0219
// VNODE pool contract address: 0x0a949beec7dc360eaf378c107f39cf8f32482c0c
// SCS pool contract address: 0x9103b5de172addc50a4449a749af96567da5d0e2
// The VNODE benificial address, should be found in the vnodeconfig.json 
VNODEVia="";

// The SCS via is in the vnodeconfig.json
SCSVia="";
VNODEVia = SCSVia;
//===============Check the Blockchain connection===============================
// 
// Using local node or remote VNODE server to send TX command
const vnodeUri = 'http://localhost:8545';

let chain3 = new Chain3();
chain3.setProvider(new chain3.providers.HttpProvider(vnodeUri));

if(!chain3.isConnected()){
    throw new Error('unable to connect to moac vnode at ' + vnodeUri);
}else{
    console.log('connected to moac vnode at ' + vnodeUri);
    let balance = chain3.mc.getBalance(baseaddr);
    console.log('Check src account balance:' + baseaddr + ' has ' + balance*1e-18 + " MC");
}

// Min balance of the baseaddr needs to be larger than these numbers if all SCSs need to be funded
// For example, if use 5 SCSs and 1 VNODE, the minimum balance is:
// + SCS deposit (10 mc) * SCS number (=5)
// + VNODE deposit (1 mc) * VNODE number (=1)
// + AppChain deposit (10 mc)
// = 50 + 1+ 10 = 61
if (!checkBalance(baseaddr, 61) ){
  console.log("Need more balance in baseaddr")
  return;
}else{
  console.log("baseaddr has enough balance!")
}

// For deploy the DappBase, this should be the SCS that will be included in the AppChain
chain3.setScsProvider(new chain3.providers.HttpProvider('http://localhost:8548'));

// check the connecting with SCS
if (!chain3.isScsConnected()){
    console.log("Chain3 RPC is not connected on SCS!");
    return;
}

// Unlock the baseaddr for contract deployment

if (chain3.personal.unlockAccount(baseaddr, basepsd, 0)) {
    console.log(`${baseaddr} is unlocked`);
}else{
    console.log(`unlock failed, ${baseaddr}`);
    throw new Error('unlock failed ' + baseaddr);
}

//===============Step 1. Deploy required contracts=========================
// If you have all these contracts deployed earlier, you can skip this and go to Step 2.
// There are 3 contracts for RandDrop AppChain:
// vnode pool
// scs pool
// vssbase

// 1.1 Deploy the VNODE pool contract to allow VNODE join as proxy to the microchain
var minVnodeDeposit = 1/* var of type uint256 here, number of deposit required for the VNODE proxy to register, unit is mc*/ ;
var vnodepoolbaseContract = chain3.mc.contract([{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"vnodeList","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"randness","type":"uint256"}],"name":"pickRandomVnode","outputs":[{"name":"target","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[],"name":"withdrawRequest","outputs":[{"name":"success","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[],"name":"withdraw","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"vnodeCount","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"vnode","type":"address"},{"name":"via","type":"address"},{"name":"link","type":"string"},{"name":"rpclink","type":"string"}],"name":"register","outputs":[{"name":"","type":"bool"}],"payable":true,"stateMutability":"payable","type":"function"},{"constant":true,"inputs":[],"name":"PEDNING_BLOCK_DELAY","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"owner","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"","type":"address"},{"name":"","type":"uint256"}],"name":"outageReportList","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"level","type":"uint256"},{"name":"startpos","type":"uint256"},{"name":"count","type":"uint256"}],"name":"sweepOutage","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"bondMin","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"_addr","type":"address"}],"name":"isPerforming","outputs":[{"name":"res","type":"bool"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"","type":"uint256"}],"name":"vnodeStore","outputs":[{"name":"from","type":"address"},{"name":"bond","type":"uint256"},{"name":"state","type":"uint256"},{"name":"registerBlock","type":"uint256"},{"name":"withdrawBlock","type":"uint256"},{"name":"rpclink","type":"string"},{"name":"via","type":"address"},{"name":"link","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"vnode","type":"address"}],"name":"reportOutage","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"WITHDRAW_BLOCK_DELAY","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"inputs":[{"name":"minVnodeDeposit","type":"uint256"}],"payable":false,"stateMutability":"nonpayable","type":"constructor"},{"payable":true,"stateMutability":"payable","type":"fallback"}]);

var vnodepoolbase = vnodepoolbaseContract.new(
   minVnodeDeposit,
   {
     from: baseaddr, 
     data: '0x606060405234156200001057600080fd5b604051602080620019b58339810160405280805191506200003290506200018f565b600060028190556003839055808252602082015260016040808301919091524360320160608301526000196080830152602090519081016040908152600080835260a084019290925260c0830191909152602090519081016040526000815260e082015260018054808201620000a98382620001ed565b6000928352602090922083916008020181518154600160a060020a031916600160a060020a03919091161781556020820151816001015560408201518160020155606082015181600301556080820151816004015560a0820151816005019080516200011a92916020019062000221565b5060c0820151600682018054600160a060020a031916600160a060020a039290921691909117905560e0820151816007019080516200015e92916020019062000221565b5050600280546001019055505060048054600160a060020a03191633600160a060020a0316179055506200039a9050565b610100604051908101604052806000600160a060020a0316815260200160008152602001600081526020016000815260200160008152602001620001d2620002a6565b815260006020820152604001620001e8620002a6565b905290565b8154818355818115116200021c576008028160080283600052602060002091820191016200021c9190620002b8565b505050565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f106200026457805160ff191683800117855562000294565b8280016001018555821562000294579182015b828111156200029457825182559160200191906001019062000277565b50620002a292915062000332565b5090565b60206040519081016040526000815290565b6200032f91905b80821115620002a2578054600160a060020a03191681556000600182018190556002820181905560038201819055600482018190556200030360058301826200034f565b600682018054600160a060020a0319169055620003256007830160006200034f565b50600801620002bf565b90565b6200032f91905b80821115620002a2576000815560010162000339565b50805460018160011615610100020316600290046000825580601f1062000377575062000397565b601f01602090049060005260206000209081019062000397919062000332565b50565b61160b80620003aa6000396000f3006060604052600436106100da5763ffffffff7c010000000000000000000000000000000000000000000000000000000060003504166301fd575b81146100df578063065a13f014610110578063380e687a1461019d5780633ccfd60b146101c45780635991e0ee146101d9578063676bea67146101ec5780637ff8fdaa1461028c5780638da5cb5b1461029f578063ab920301146102ce578063b08bcb1f146102f0578063cb7f82661461030c578063ce9d9bd71461031f578063dcd3cab21461033e578063ee8c9dd514610483578063f9eae020146104a2575b600080fd5b34156100ea57600080fd5b6100fe600160a060020a03600435166104b5565b60405190815260200160405180910390f35b341561011b57600080fd5b6101266004356104c7565b60405160208082528190810183818151815260200191508051906020019080838360005b8381101561016257808201518382015260200161014a565b50505050905090810190601f16801561018f5780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b34156101a857600080fd5b6101b0610619565b604051901515815260200160405180910390f35b34156101cf57600080fd5b6101d761070e565b005b34156101e457600080fd5b6100fe610a9c565b6101b0600160a060020a036004803582169160248035909116919060649060443590810190830135806020601f8201819004810201604051908101604052818152929190602084018383808284378201915050505050509190803590602001908201803590602001908080601f016020809104026020016040519081016040528181529291906020840183838082843750949650610aa295505050505050565b341561029757600080fd5b6100fe610c28565b34156102aa57600080fd5b6102b2610c2d565b604051600160a060020a03909116815260200160405180910390f35b34156102d957600080fd5b6102b2600160a060020a0360043516602435610c3c565b34156102fb57600080fd5b6101d7600435602435604435610c73565b341561031757600080fd5b6100fe610ff2565b341561032a57600080fd5b6101b0600160a060020a0360043516610ff8565b341561034957600080fd5b6103546004356110a7565b6040518089600160a060020a0316600160a060020a031681526020018881526020018781526020018681526020018581526020018060200184600160a060020a0316600160a060020a0316815260200180602001838103835286818151815260200191508051906020019080838360005b838110156103dd5780820151838201526020016103c5565b50505050905090810190601f16801561040a5780820380516001836020036101000a031916815260200191505b50838103825284818151815260200191508051906020019080838360005b83811015610440578082015183820152602001610428565b50505050905090810190601f16801561046d5780820380516001836020036101000a031916815260200191505b509a505050505050505050505060405180910390f35b341561048e57600080fd5b6101d7600160a060020a0360043516611253565b34156104ad57600080fd5b6100fe61133b565b60006020819052908152604090205481565b6104cf611341565b60006002805410156104f1576020604051908101604052600081529150610613565b600254838115156104fe57fe5b06905080151561050c576001015b61053d60018281548110151561051e57fe5b6000918252602090912060089091020154600160a060020a0316610ff8565b1561060157600180548290811061055057fe5b90600052602060002090600802016007018054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156105f55780601f106105ca576101008083540402835291602001916105f5565b820191906000526020600020905b8154815290600101906020018083116105d857829003601f168201915b50505050509150610613565b60206040519081016040526000815291505b50919050565b600160a060020a033316600090815260208190526040812054819081901161064057600080fd5b50600160a060020a033316600081815260208190526040902054600180549192918390811061066b57fe5b6000918252602090912060089091020154600160a060020a03161461068f57600080fd5b60018080548390811061069e57fe5b9060005260206000209060080201600201541415156106bc57600080fd5b436001828154811015156106cc57fe5b6000918252602090912060046008909202010155600260018054839081106106f057fe5b906000526020600020906008020160020181905550600191505b5090565b600160a060020a033316600090815260208190526040812054819081901161073557600080fd5b600160a060020a03331660008181526020819052604090205460018054919450908490811061076057fe5b6000918252602090912060089091020154600160a060020a03161461078457600080fd5b6002600180548490811061079457fe5b9060005260206000209060080201600201541480156107d657506121c06001838154811015156107c057fe5b9060005260206000209060080201600401540143115b15610a985760018054839081106107e957fe5b600091825260209091206001600890920201810154600280546000190190819055825491935090811061081857fe5b600091825260209091206008909102015460018054600160a060020a03909216918490811061084357fe5b906000526020600020906008020160000160006101000a815481600160a060020a030219169083600160a060020a03160217905550600160025481548110151561088957fe5b9060005260206000209060080201600101546001838154811015156108aa57fe5b90600052602060002090600802016001018190555060016002548154811015156108d057fe5b9060005260206000209060080201600301546001838154811015156108f157fe5b906000526020600020906008020160030181905550600160025481548110151561091757fe5b90600052602060002090600802016004015460018381548110151561093857fe5b906000526020600020906008020160040181905550600160025481548110151561095e57fe5b906000526020600020906008020160070160018381548110151561097e57fe5b906000526020600020906008020160070190805460018160011615610100020316600290046109ae929190611353565b5060016002548154811015156109c057fe5b6000918252602082206008909102018054600160a060020a03191681556001810182905560028101829055600381018290556004810182905590610a0760058301826113d4565b600682018054600160a060020a0319169055610a276007830160006113d4565b505081600080600185815481101515610a3c57fe5b60009182526020808320600890920290910154600160a060020a03908116845290830193909352604091820190209290925533169082156108fc0290839051600060405180830381858888f193505050501515610a9857600080fd5b5050565b60025481565b6000610aac61141b565b600160a060020a038616600090815260208190526040902054158015610ade5750600354670de0b6b3a7640000023410155b1515610ae957600080fd5b600160a060020a038616815234602082015260016040820152436032016060820152600019608082015260a08101839052600160a060020a03851660c082015260e0810184905260018054808201610b418382611475565b6000928352602090922083916008020181518154600160a060020a031916600160a060020a03919091161781556020820151816001015560408201518160020155606082015181600301556080820151816004015560a082015181600501908051610bb09291602001906114a6565b5060c0820151600682018054600160a060020a031916600160a060020a039290921691909117905560e082015181600701908051610bf29291602001906114a6565b505060028054600160a060020a038a16600090815260208190526040902081905560019081019091559350505050949350505050565b603281565b600454600160a060020a031681565b600560205281600052604060002081815481101515610c5757fe5b600091825260209091200154600160a060020a03169150829050565b600454600090819033600160a060020a03908116911614610c9357600080fd5b600085118015610ca4575060058511155b1515610caf57600080fd5b600084118015610cc0575060025484105b1515610ccb57600080fd5b6002546000198585010192508210610ce65760016002540391505b50805b838110610feb578460056000600184815481101515610d0457fe5b60009182526020808320600890920290910154600160a060020a0316835282019290925260400190205410610fe25760056000600183815481101515610d4657fe5b60009182526020808320600890920290910154600160a060020a031683528201929092526040018120610d7891611514565b600280546000190190819055600180549091908110610d9357fe5b600091825260209091206008909102015460018054600160a060020a039092169183908110610dbe57fe5b906000526020600020906008020160000160006101000a815481600160a060020a030219169083600160a060020a031602179055506001600254815481101515610e0457fe5b906000526020600020906008020160010154600182815481101515610e2557fe5b9060005260206000209060080201600101819055506001600254815481101515610e4b57fe5b906000526020600020906008020160030154600182815481101515610e6c57fe5b9060005260206000209060080201600301819055506001600254815481101515610e9257fe5b906000526020600020906008020160040154600182815481101515610eb357fe5b9060005260206000209060080201600401819055506001600254815481101515610ed957fe5b9060005260206000209060080201600701600182815481101515610ef957fe5b90600052602060002090600802016007019080546001816001161561010002031660029004610f29929190611353565b506001600254815481101515610f3b57fe5b6000918252602082206008909102018054600160a060020a03191681556001810182905560028101829055600381018290556004810182905590610f8260058301826113d4565b600682018054600160a060020a0319169055610fa26007830160006113d4565b505080600080600184815481101515610fb757fe5b60009182526020808320600890920290910154600160a060020a031683528201929092526040019020555b60001901610ce9565b5050505050565b60035481565b600160a060020a038116600090815260208190526040812054151561101f575060006110a2565b6001600160a060020a03831660009081526020819052604090205460018054909190811061104957fe5b90600052602060002090600802016002015414801561109f5750600160a060020a03821660009081526020819052604090205460018054439290811061108b57fe5b906000526020600020906008020160030154105b90505b919050565b60018054829081106110b557fe5b90600052602060002090600802016000915090508060000160009054906101000a9004600160a060020a031690806001015490806002015490806003015490806004015490806005018054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156111925780601f1061116757610100808354040283529160200191611192565b820191906000526020600020905b81548152906001019060200180831161117557829003601f168201915b5050505050908060060160009054906101000a9004600160a060020a031690806007018054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156112495780601f1061121e57610100808354040283529160200191611249565b820191906000526020600020905b81548152906001019060200180831161122c57829003601f168201915b5050505050905088565b600160a060020a03811660009081526005602081905260408220541015610a98575060005b600160a060020a0382166000908152600560205260409020548110156112ea57600160a060020a03828116600090815260056020526040902080543390921691839081106112c257fe5b600091825260209091200154600160a060020a031614156112e257610a98565b600101611278565b600160a060020a03821660009081526005602052604090208054600181016113128382611532565b5060009182526020909120018054600160a060020a03191633600160a060020a03161790555050565b6121c081565b60206040519081016040526000815290565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f1061138c57805485556113c8565b828001600101855582156113c857600052602060002091601f016020900482015b828111156113c85782548255916001019190600101906113ad565b5061070a929150611552565b50805460018160011615610100020316600290046000825580601f106113fa5750611418565b601f0160209004906000526020600020908101906114189190611552565b50565b610100604051908101604052806000600160a060020a031681526020016000815260200160008152602001600081526020016000815260200161145c611341565b815260006020820152604001611470611341565b905290565b8154818355818115116114a1576008028160080283600052602060002091820191016114a1919061156f565b505050565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f106114e757805160ff19168380011785556113c8565b828001600101855582156113c8579182015b828111156113c85782518255916020019190600101906114f9565b50805460008255906000526020600020908101906114189190611552565b8154818355818115116114a1576000838152602090206114a19181019083015b61156c91905b8082111561070a5760008155600101611558565b90565b61156c91905b8082111561070a578054600160a060020a03191681556000600182018190556002820181905560038201819055600482018190556115b660058301826113d4565b600682018054600160a060020a03191690556115d66007830160006113d4565b506008016115755600a165627a7a7230582090973e5adc7f1ebf474e3fcf6a1a34ec942c11e86a0dd6658a8800c20e4030610029', 
     gas: '8000000'
   }
 );

console.log("VNODE protocol is being deployed at transaction HASH: " + vnodepoolbase.transactionHash);

// 1.2 Deploy the SCS protocol pool contract to allow SCS join the pool to form the AppChain 
// precompiled contract
// Deploy the AppChain protocol pool to allow SCS join the pool to form the AppChain 
var protocol = "bls";   //Name of the SCS pool, don't change
var minScsDeposit = 5 ;// SCS must pay more than this in the register function to get into the SCS pool
var _protocolType = 3 ; // type of the AppChain protocol, don't change

var scspoolbaseContract = chain3.mc.contract([{"constant":true,"inputs":[{"name":"addr","type":"address"}],"name":"approvalAddresses","outputs":[{"name":"","type":"address[]"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"scs","type":"address"},{"name":"amount","type":"uint256"}],"name":"releaseFromSubchain","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[],"name":"setSubchainActiveBlock","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[],"name":"withdrawRequest","outputs":[{"name":"success","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[],"name":"withdraw","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"addr","type":"address"}],"name":"approvalAmounts","outputs":[{"name":"","type":"uint256[]"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"scs","type":"address"}],"name":"register","outputs":[{"name":"","type":"bool"}],"payable":true,"stateMutability":"payable","type":"function"},{"constant":false,"inputs":[{"name":"scs","type":"address"},{"name":"amount","type":"uint256"},{"name":"v","type":"uint8"},{"name":"r","type":"bytes32"},{"name":"s","type":"bytes32"}],"name":"approveBond","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"scs","type":"address"},{"name":"amount","type":"uint256"}],"name":"forfeitBond","outputs":[{"name":"","type":"bool"}],"payable":true,"stateMutability":"payable","type":"function"},{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"subChainLastActiveBlock","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"scsCount","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"scsApprovalList","outputs":[{"name":"bondApproved","type":"uint256"},{"name":"bondedCount","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"PENDING_BLOCK_DELAY","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"scs","type":"address"},{"name":"subchain","type":"address"}],"name":"releaseRequest","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"","type":"uint256"}],"name":"scsArray","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"blk","type":"uint256"}],"name":"setSubchainExpireBlock","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"protocolType","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"subChainExpireBlock","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"scsList","outputs":[{"name":"from","type":"address"},{"name":"bond","type":"uint256"},{"name":"state","type":"uint256"},{"name":"registerBlock","type":"uint256"},{"name":"withdrawBlock","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"bondMin","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"_addr","type":"address"}],"name":"isPerforming","outputs":[{"name":"res","type":"bool"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"thousandth","type":"uint256"},{"name":"minnum","type":"uint256"}],"name":"getSelectionTarget","outputs":[{"name":"target","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"targetnum","type":"uint256"}],"name":"getSelectionTargetByCount","outputs":[{"name":"target","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"subChainProtocol","outputs":[{"name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"WITHDRAW_BLOCK_DELAY","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"inputs":[{"name":"protocol","type":"string"},{"name":"minScsDeposit","type":"uint256"},{"name":"_protocolType","type":"uint256"}],"payable":false,"stateMutability":"nonpayable","type":"constructor"},{"payable":true,"stateMutability":"payable","type":"fallback"},{"anonymous":false,"inputs":[{"indexed":false,"name":"scs","type":"address"}],"name":"Registered","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"sender","type":"address"}],"name":"UnRegistered","type":"event"}]);
var scspoolbase = scspoolbaseContract.new(
   protocol,
   minScsDeposit,
   _protocolType,
   {
     from: baseaddr, 
     data: '0x606060405234156200001057600080fd5b6040516200178338038062001783833981016040528080518201919060200180519190602001805160006002559150600390508380516200005692916020019062000067565b50600491909155600855506200010c565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f10620000aa57805160ff1916838001178555620000da565b82800160010185558215620000da579182015b82811115620000da578251825591602001919060010190620000bd565b50620000e8929150620000ec565b5090565b6200010991905b80821115620000e85760008155600101620000f3565b90565b611667806200011c6000396000f3006060604052600436106101485763ffffffff7c01000000000000000000000000000000000000000000000000000000006000350416631aa887ca811461014d578063202cc5e1146101bf578063365bfb9e146101f5578063380e687a1461020a5780633ccfd60b1461021d57806341205305146102305780634420e4861461024f5780636220fb1d1461026357806364f3ef461461029157806367bd927e146102a85780636e62adcb146102d957806376a95e88146102ec57806399f874d8146103235780639adea80714610336578063aab319331461035b578063b8a167e61461038d578063bd8d4bd8146103a3578063c3a919d0146103b6578063c9a856a3146103d5578063cb7f82661461042f578063ce9d9bd714610442578063de42f13c14610461578063e17095a41461047a578063f21e6f7a14610490578063f9eae0201461051a575b600080fd5b341561015857600080fd5b61016c600160a060020a036004351661052d565b60405160208082528190810183818151815260200191508051906020019060200280838360005b838110156101ab578082015183820152602001610193565b505050509050019250505060405180910390f35b34156101ca57600080fd5b6101e1600160a060020a0360043516602435610612565b604051901515815260200160405180910390f35b341561020057600080fd5b6102086108c2565b005b341561021557600080fd5b6101e16108df565b341561022857600080fd5b6102086109aa565b341561023b57600080fd5b61016c600160a060020a0360043516610a45565b6101e1600160a060020a0360043516610b0d565b341561026e57600080fd5b6101e1600160a060020a036004351660243560ff60443516606435608435610c33565b6101e1600160a060020a0360043516602435610e1e565b34156102b357600080fd5b6102c7600160a060020a0360043516611115565b60405190815260200160405180910390f35b34156102e457600080fd5b6102c7611127565b34156102f757600080fd5b61030b600160a060020a036004351661112d565b60405191825260208201526040908101905180910390f35b341561032e57600080fd5b6102c7611146565b341561034157600080fd5b6101e1600160a060020a036004358116906024351661114b565b341561036657600080fd5b610371600435611265565b604051600160a060020a03909116815260200160405180910390f35b341561039857600080fd5b61020860043561128d565b34156103ae57600080fd5b6102c76112a8565b34156103c157600080fd5b6102c7600160a060020a03600435166112ae565b34156103e057600080fd5b6103f4600160a060020a03600435166112c0565b604051600160a060020a03909516855260208501939093526040808501929092526060840152608083019190915260a0909101905180910390f35b341561043a57600080fd5b6102c76112f9565b341561044d57600080fd5b6101e1600160a060020a03600435166112ff565b341561046c57600080fd5b6102c760043560243561134b565b341561048557600080fd5b6102c76004356113ad565b341561049b57600080fd5b6104a36113f3565b60405160208082528190810183818151815260200191508051906020019080838360005b838110156104df5780820151838201526020016104c7565b50505050905090810190601f16801561050c5780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b341561052557600080fd5b6102c7611491565b6105356115ec565b61053d6115ec565b600160a060020a03831660009081526001602081905260408083209091015490518059106105685750595b90808252806020026020018201604052509150600090505b600160a060020a0384166000908152600160208190526040909120015481101561060b57600160a060020a03841660009081526001602052604090206002018054829081106105cb57fe5b600091825260209091200154600160a060020a03168282815181106105ec57fe5b600160a060020a03909216602092830290910190910152600101610580565b5092915050565b6000805b600160a060020a038416600090815260016020819052604090912001548110156108b857600160a060020a038481166000908152600160205260409020600201805433909216918390811061066757fe5b600091825260209091200154600160a060020a03161480156106bc5750600160a060020a03841660009081526001602052604090206003018054849190839081106106ae57fe5b906000526020600020900154145b156108b057600160a060020a0384166000908152600160208190526040909120805485900381559081018054600019019081905560029091018054909190811061070257fe5b6000918252602080832090910154600160a060020a0387811684526001909252604090922060020180549190921691908390811061073c57fe5b60009182526020808320919091018054600160a060020a031916600160a060020a039485161790559186168152600191829052604090209081015460039091018054909190811061078957fe5b6000918252602080832090910154600160a060020a0387168352600190915260409091206003018054839081106107bc57fe5b6000918252602080832090910192909255600160a060020a038616815260019182905260409020908101546002909101805490919081106107f957fe5b600091825260208083209091018054600160a060020a0319169055600160a060020a038616825260019081905260409091209081015460039091018054909190811061084157fe5b60009182526020808320909101829055600160a060020a038616825260019052604090206002018054906108799060001983016115fe565b50600160a060020a03841660009081526001602052604090206003018054906108a69060001983016115fe565b506001915061060b565b600101610616565b5060009392505050565b600160a060020a0333166000908152600560205260409020439055565b33600160a060020a031660009081526020819052604081206002015460011461090757600080fd5b600160a060020a033316600090815260016020819052604090912001541561092e57600080fd5b33600160a060020a03811660009081526020819052604090204360048201556002908101819055805460001901905561096690611497565b7f4803dcd528253b802a22997f7a3b15bcc6be53c1f2ba8f110aa26c25d652a68f33604051600160a060020a03909116815260200160405180910390a15060015b90565b6002600160a060020a0333166000908152602081905260409020600201541480156109f35750600160a060020a0333166000908152602081905260409020600401546121c00143115b15610a4357600160a060020a0333811660009081526020819052604090819020805460019091015492169180156108fc029151600060405180830381858888f193505050501515610a4357600080fd5b565b610a4d6115ec565b610a556115ec565b600160a060020a0383166000908152600160208190526040808320909101549051805910610a805750595b90808252806020026020018201604052509150600090505b600160a060020a0384166000908152600160208190526040909120015481101561060b57600160a060020a0384166000908152600160205260409020600301805482908110610ae357fe5b906000526020600020900154828281518110610afb57fe5b60209081029091010152600101610a98565b600160a060020a0381166000908152602081905260408120600201541580610b5057506001600160a060020a038316600090815260208190526040902060020154145b8015610b685750600454670de0b6b3a7640000023410155b1515610b7357600080fd5b610b7c8261158f565b600160a060020a03821660008181526020819052604090208054600160a060020a0319169091178155600201541515610bea57600160a060020a0382166000908152602081905260409020436003820155600019600482015560028054600190810190915534910155610c0c565b600160a060020a03821660009081526020819052604090206001018054340190555b6001600160a060020a0383166000908152602081905260409020600201555060015b919050565b600080610c3f876112ff565b1515610c4e5760009150610e14565b600287336040516c01000000000000000000000000600160a060020a0393841681028252919092160260148201526028016020604051808303816000865af11515610c9857600080fd5b50506040518051915050600160a060020a0387166001828787876040516000815260200160405260405193845260ff9092166020808501919091526040808501929092526060840192909252608090920191516020810390808403906000865af11515610d0457600080fd5b505060206040510351600160a060020a031614610d245760009150610e14565b600160a060020a038716600090815260016020818152604080842054918490529092200154908701901015610d5c5760009150610e14565b600160a060020a0387166000908152600160208190526040909120805488018155600201805490918101610d9083826115fe565b5060009182526020808320919091018054600160a060020a03191633600160a060020a0390811691909117909155891682526001908190526040909120600301805490918101610de083826115fe565b506000918252602080832091909101889055600160a060020a03891682526001908190526040909120810180548201905591505b5095945050505050565b6000805b600160a060020a038416600090815260016020819052604090912001548110156108b857600160a060020a0384811660009081526001602052604090206002018054339092169183908110610e7357fe5b600091825260209091200154600160a060020a0316148015610ec85750600160a060020a0384166000908152600160205260409020600301805484919083908110610eba57fe5b906000526020600020900154145b1561110d57600160a060020a03841660009081526001602081905260409091208054859003815590810180546000190190819055600290910180549091908110610f0e57fe5b6000918252602080832090910154600160a060020a03878116845260019092526040909220600201805491909216919083908110610f4857fe5b60009182526020808320919091018054600160a060020a031916600160a060020a0394851617905591861681526001918290526040902090810154600390910180549091908110610f9557fe5b6000918252602080832090910154600160a060020a038716835260019091526040909120600301805483908110610fc857fe5b6000918252602080832090910192909255600160a060020a0386168152600191829052604090209081015460029091018054909190811061100557fe5b600091825260208083209091018054600160a060020a0319169055600160a060020a038616825260019081905260409091209081015460039091018054909190811061104d57fe5b60009182526020808320909101829055600160a060020a038616825260019052604090206002018054906110859060001983016115fe565b50600160a060020a03841660009081526001602052604090206003018054906110b29060001983016115fe565b50600160a060020a038085166000908152602081905260409081902060010180548690039055339091169084156108fc0290859051600060405180830381858888f19350505050151561110457600080fd5b6001915061060b565b600101610e22565b60056020526000908152604090205481565b60025481565b6001602081905260009182526040909120805491015482565b600081565b6000805b600160a060020a038416600090815260016020819052604090912001548110156108b857600160a060020a0384811660009081526001602052604090206002018054918516918390811061119f57fe5b600091825260209091200154600160a060020a03161480156111e65750600160a060020a038316600090815260066020908152604080832054600590925290912054439101105b1561125d57600160a060020a038416600090815260016020526040902060030180548290811061121257fe5b6000918252602080832090910154600160a060020a03871683526001918290526040909220805492909203825581018054600019019081905560029091018054909190811061070257fe5b60010161114f565b600780548290811061127357fe5b600091825260209091200154600160a060020a0316905081565b600160a060020a033316600090815260066020526040902055565b60085481565b60066020526000908152604090205481565b60006020819052908152604090208054600182015460028301546003840154600490940154600160a060020a0390931693919290919085565b60045481565b600160a060020a03811660009081526020819052604081206002015460011480156113455750600160a060020a0382166000908152602081905260409020600301544390105b92915050565b600080603283101561135c57603292505b82600254101561136f5760ff915061060b565b506002546103e890840204828110156113855750815b60028054826101000281151561139757fe5b046001018115156113a457fe5b04949350505050565b6000816002541115156113c2575060ff610c2e565b6002805483610100028115156113d457fe5b046001018115156113e157fe5b049050801515610c2e57506000919050565b60038054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156114895780601f1061145e57610100808354040283529160200191611489565b820191906000526020600020905b81548152906001019060200180831161146c57829003601f168201915b505050505081565b6121c081565b600754805b600081111561158a5782600160a060020a03166007600183038154811015156114c157fe5b600091825260209091200154600160a060020a03161415611581576007805460001984019081106114ee57fe5b60009182526020909120015460078054600160a060020a0390921691600019840190811061151857fe5b60009182526020909120018054600160a060020a031916600160a060020a039290921691909117905560078054600019840190811061155357fe5b60009182526020909120018054600160a060020a0319169055600780549061157f9060001983016115fe565b505b6000190161149c565b505050565b600160a060020a03811660009081526020819052604090206002015415156115e95760078054600181016115c383826115fe565b5060009182526020909120018054600160a060020a031916600160a060020a0383161790555b50565b60206040519081016040526000815290565b81548183558181151161158a5760008381526020902061158a9181019083016109a791905b808211156116375760008155600101611623565b50905600a165627a7a723058200a749721f5b6f398f69bf4039c420a9dd8d618862a2d09c7e2aca0669046b9f80029', 
     gas: '4700000'
   }
 )

console.log("SCS protocol is being deployed at transaction HASH: " + scspoolbase.transactionHash);

// 1.3 Deploy the VSS contract to be called by the RandDrop AppChain 
var threshold = 3/* var of type int256 here,  */ ;
var vssbaseContract = chain3.mc.contract([{"constant":true,"inputs":[],"name":"getActiveVSSMemberCount","outputs":[{"name":"","type":"int256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"","type":"bytes32"}],"name":"revealed","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"newOwner","type":"address"}],"name":"setOwner","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[],"name":"resetVSSGroup","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"","type":"int256"}],"name":"slashed","outputs":[{"name":"","type":"int256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"nodes","type":"address[]"}],"name":"getVSSNodesPubkey","outputs":[{"name":"","type":"bytes32[]"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"lastSender","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"violator","type":"address"},{"name":"pubShare","type":"bytes"},{"name":"pubSig","type":"bytes"},{"name":"priShare","type":"bytes"},{"name":"priSig","type":"bytes"},{"name":"revealedPri","type":"bytes"}],"name":"reveal","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"nodes","type":"address[]"}],"name":"getVSSNodesIndexs","outputs":[{"name":"","type":"int256[]"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"lastConfigUpload","outputs":[{"name":"","type":"int256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"","type":"int256"}],"name":"revealedReporter","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"","type":"int256"},{"name":"","type":"address"}],"name":"slashingVoters","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"configVersion","type":"int256"}],"name":"vote","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"slowNodeThreshold","outputs":[{"name":"","type":"int256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"scs","type":"address"}],"name":"getSCSRole","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"lastNodeChangeConfigVersion","outputs":[{"name":"","type":"int256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"","type":"int256"}],"name":"revealedViolator","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"index","type":"int256"},{"name":"slash","type":"bool"}],"name":"slashing","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"","type":"bytes32"}],"name":"revealedSigMapping","outputs":[{"name":"","type":"int256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"","type":"int256"}],"name":"slashingRejects","outputs":[{"name":"","type":"int256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"","type":"address"},{"name":"","type":"int256"}],"name":"slowNodeVotes","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"lastSlashingVoted","outputs":[{"name":"","type":"int256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"","type":"int256"}],"name":"reveals","outputs":[{"name":"PubShare","type":"bytes"},{"name":"PubSig","type":"bytes"},{"name":"PriShare","type":"bytes"},{"name":"PriSig","type":"bytes"},{"name":"Revealed","type":"bytes"},{"name":"Violator","type":"address"},{"name":"Whistleblower","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"violator","type":"address"}],"name":"reportSlowNode","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"lastNodeChangeBlock","outputs":[{"name":"","type":"int256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"addr","type":"address"}],"name":"getLastSlashVoted","outputs":[{"name":"","type":"int256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"node","type":"address"}],"name":"getPublicShares","outputs":[{"name":"","type":"bytes"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"index","type":"int256"}],"name":"getRevealedShare","outputs":[{"components":[{"name":"PubShare","type":"bytes"},{"name":"PubSig","type":"bytes"},{"name":"PriShare","type":"bytes"},{"name":"PriSig","type":"bytes"},{"name":"Revealed","type":"bytes"},{"name":"Violator","type":"address"},{"name":"Whistleblower","type":"address"}],"name":"","type":"tuple"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"owner","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"configVersion","type":"int256"}],"name":"isConfigReady","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"node","type":"address"}],"name":"getPrivateShares","outputs":[{"name":"","type":"bytes"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"","type":"int256"}],"name":"slashingVotes","outputs":[{"name":"","type":"int256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"vssThreshold","outputs":[{"name":"","type":"int256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"vssNodeMemberships","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"revealIndex","outputs":[{"name":"","type":"int256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"","type":"int256"},{"name":"","type":"address"}],"name":"voters","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"configVersion","type":"int256"}],"name":"isSlashed","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"GetLastSender","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"lastConfigUploadByBlock","outputs":[{"name":"","type":"int256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"vssConfigVersion","outputs":[{"name":"","type":"int256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"callerAddr","type":"address"}],"name":"setCaller","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"publicShares","type":"bytes"},{"name":"privateShares","type":"bytes"}],"name":"uploadVSSConfig","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"vssNodeCount","outputs":[{"name":"","type":"int256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"newThreshold","type":"int256"}],"name":"setSlowNodeThreshold","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"","type":"int256"}],"name":"votes","outputs":[{"name":"","type":"int256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"GetCaller","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"","type":"address"},{"name":"","type":"int256"},{"name":"","type":"address"}],"name":"slowNodeVoted","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"sender","type":"address"}],"name":"deactivateVSS","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"sender","type":"address"}],"name":"activateVSS","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"getActiveVSSMemberList","outputs":[{"name":"","type":"address[]"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"sender","type":"address"},{"name":"publickey","type":"bytes32"}],"name":"registerVSS","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"newThreshold","type":"int256"}],"name":"setThreshold","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"sender","type":"address"}],"name":"unregisterVSS","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"scs","type":"address"}],"name":"getVSSNodeIndex","outputs":[{"name":"","type":"int256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"caller","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"inputs":[{"name":"threshold","type":"int256"}],"payable":false,"stateMutability":"nonpayable","type":"constructor"}]);
var vssbase = vssbaseContract.new(
   threshold,
   {
     from: baseaddr, 
     data: '0x608060405260006019556000601a556000601b556000601c556000601d556000601e556032601f553480156200003457600080fd5b5060405160208062002b38833981018060405262000056919081019062000086565b60195560168054600160a060020a03191633179055620000b2565b60006200007f8251620000af565b9392505050565b6000602082840312156200009957600080fd5b6000620000a7848462000071565b949350505050565b90565b612a7680620000c26000396000f3006080604052600436106102925763ffffffff7c0100000000000000000000000000000000000000000000000000000000600035041663029471e081146102975780630b927b32146102c257806313af4035146102ef5780631a1efdaf146103115780631c2c6b4d146103265780632512b94714610346578063256fec8814610373578063282c0b8f146103955780632a292dc7146103b55780632a56ce43146103e2578063307f201a146104025780633430cadd146104225780633891c320146104425780633ed4f1161461046257806350859fd914610477578063514cac351461049757806351ed07e4146104ac57806356a09939146104cc57806359495523146104ec5780635e2968531461050c5780636911af651461052c5780637457b3551461054c578063778ada101461056c5780637ce54cc81461059f5780637d0f6c77146105bf5780637e2a1ed3146105d457806380c3fe62146105f45780638b051563146106215780638da5cb5b1461064e57806391e4d7f7146106635780639496db221461068357806394a629be146106a3578063984624ba146106c357806398b72f98146106d857806399ba5a92146106f85780639c0818521461070d5780639d6e8c6c1461072d5780639f1e5f0e1461074d578063b5ef046e14610762578063bbc3d23714610782578063beb92f5514610797578063ca6c8a31146107b7578063cc30a60f146107d7578063cd199420146107ec578063d0bef4ae1461080c578063d89da49c1461082c578063dbccad5414610841578063de79b85614610861578063e4c1de9814610881578063ed0c88ef146108a1578063eefb4227146108c3578063ef0fb558146108e3578063f06dc92d14610903578063fc054aa814610923578063fc9c8d3914610943575b600080fd5b3480156102a357600080fd5b506102ac610958565b6040516102b99190612950565b60405180910390f35b3480156102ce57600080fd5b506102e26102dd36600461255c565b6109a9565b6040516102b991906128a8565b3480156102fb57600080fd5b5061030f61030a36600461235d565b6109be565b005b34801561031d57600080fd5b5061030f6109f7565b34801561033257600080fd5b506102ac61034136600461255c565b610aa3565b34801561035257600080fd5b50610366610361366004612509565b610ab5565b6040516102b99190612886565b34801561037f57600080fd5b50610388610b60565b6040516102b99190612846565b3480156103a157600080fd5b5061030f6103b03660046123bd565b610b6f565b3480156103c157600080fd5b506103d56103d0366004612509565b610e64565b6040516102b99190612897565b3480156103ee57600080fd5b506102ac6103fd36600461235d565b610f08565b34801561040e57600080fd5b5061038861041d36600461255c565b610f1a565b34801561042e57600080fd5b506102e261043d3660046125d9565b610f35565b34801561044e57600080fd5b5061030f61045d36600461255c565b610f55565b34801561046e57600080fd5b506102ac610fd0565b34801561048357600080fd5b506102ac61049236600461235d565b610fd6565b3480156104a357600080fd5b506102ac61107b565b3480156104b857600080fd5b506103886104c736600461255c565b611081565b3480156104d857600080fd5b5061030f6104e7366004612609565b61109c565b3480156104f857600080fd5b506102ac61050736600461255c565b6112af565b34801561051857600080fd5b506102ac61052736600461255c565b6112c1565b34801561053857600080fd5b506102ac610547366004612383565b6112d3565b34801561055857600080fd5b506102ac61056736600461235d565b6112f0565b34801561057857600080fd5b5061058c61058736600461255c565b611302565b6040516102b997969594939291906128c7565b3480156105ab57600080fd5b5061030f6105ba36600461235d565b61160c565b3480156105cb57600080fd5b506102ac61179e565b3480156105e057600080fd5b506102ac6105ef36600461235d565b6117a4565b34801561060057600080fd5b5061061461060f36600461235d565b6117c3565b6040516102b991906128b6565b34801561062d57600080fd5b5061064161063c36600461255c565b61186e565b6040516102b9919061295e565b34801561065a57600080fd5b50610388611ba1565b34801561066f57600080fd5b506102e261067e36600461255c565b611bb0565b34801561068f57600080fd5b5061061461069e36600461235d565b611bd9565b3480156106af57600080fd5b506102ac6106be36600461255c565b611c4d565b3480156106cf57600080fd5b506102ac611c5f565b3480156106e457600080fd5b506102ac6106f336600461235d565b611c65565b34801561070457600080fd5b506102ac611c77565b34801561071957600080fd5b506102e26107283660046125d9565b611c7d565b34801561073957600080fd5b506102e261074836600461255c565b611c9d565b34801561075957600080fd5b50610388611cb0565b34801561076e57600080fd5b506102ac61077d36600461235d565b611cc0565b34801561078e57600080fd5b506102ac611cd2565b3480156107a357600080fd5b5061030f6107b236600461235d565b611cd8565b3480156107c357600080fd5b5061030f6107d236600461257a565b611d11565b3480156107e357600080fd5b506102ac611d9d565b3480156107f857600080fd5b5061030f61080736600461255c565b611da3565b34801561081857600080fd5b506102ac61082736600461255c565b611dbf565b34801561083857600080fd5b50610388611dd1565b34801561084d57600080fd5b506102e261085c3660046124bc565b611de0565b34801561086d57600080fd5b5061030f61087c36600461235d565b611e06565b34801561088d57600080fd5b5061030f61089c36600461235d565b611e7b565b3480156108ad57600080fd5b506108b6611f7f565b6040516102b99190612875565b3480156108cf57600080fd5b5061030f6108de366004612383565b612057565b3480156108ef57600080fd5b5061030f6108fe36600461255c565b6120b4565b34801561090f57600080fd5b5061030f61091e36600461235d565b6120d9565b34801561092f57600080fd5b506102ac61093e36600461235d565b612141565b34801561094f57600080fd5b5061038861215c565b600080805b601a548112156109a3576001600082815260026020908152604080832054600160a060020a031683526003909152902054141561099b576001909101905b60010161095d565b50919050565b600c6020526000908152604090205460ff1681565b601654600160a060020a031633146109d557600080fd5b60168054600160a060020a031916600160a060020a0392909216919091179055565b601654600160a060020a03163314610a0e57600080fd5b6040517f219dc4a0000000000000000000000000000000000000000000000000000000008152600d9063219dc4a090610a4e903090600f9060040161285a565b602060405180830381600087803b158015610a6857600080fd5b505af1158015610a7c573d6000803e3d6000fd5b505050506040513d601f19601f82011682018060405250610aa0919081019061253e565b50565b600b6020526000908152604090205481565b60606000606060008451925082604051908082528060200260200182016040528015610aeb578160200160208202803883390190505b509150600090505b8451811015610b58576000808683815181101515610b0d57fe5b90602001906020020151600160a060020a0316600160a060020a03168152602001908152602001600020548282815181101515610b4657fe5b60209081029091010152600101610af3565b509392505050565b601854600160a060020a031681565b33600090815260036020526040812054600114610b8b57600080fd5b84836040518083805190602001908083835b60208310610bbc5780518252601f199092019160209182019101610b9d565b51815160209384036101000a600019018019909216911617905285519190930192850191508083835b60208310610c045780518252601f199092019160209182019101610be5565b51815160209384036101000a600019018019909216911617905260408051929094018290039091206000818152600c909252929020549195505060ff16159250610c5091505057600080fd5b601c80546000908152600d602090815260408083208054600160a060020a0319908116600160a060020a038e1690811790925585548552600e8452828520805433921682179055825160e0810184528c81528085018c90528084018b9052606081018a90526080810189905260a081019290925260c082015293548352600f8252909120825180519192610ce99284929091019061216b565b506020828101518051610d02926001850192019061216b565b5060408201518051610d1e91600284019160209091019061216b565b5060608201518051610d3a91600384019160209091019061216b565b5060808201518051610d5691600484019160209091019061216b565b5060a0820151600582018054600160a060020a0319908116600160a060020a039384161790915560c0909301516006909201805490931691161790556000818152600c60209081526040808320805460ff19166001908117909155601c805460119094529190932082905591019055600d63219dc4a030600f6040518363ffffffff167c0100000000000000000000000000000000000000000000000000000000028152600401610e0892919061285a565b602060405180830381600087803b158015610e2257600080fd5b505af1158015610e36573d6000803e3d6000fd5b505050506040513d601f19601f82011682018060405250610e5a919081019061253e565b5050505050505050565b60606000606060008451925082604051908082528060200260200182016040528015610e9a578160200160208202803883390190505b509150600090505b8451811015610b5857600160008683815181101515610ebd57fe5b90602001906020020151600160a060020a0316600160a060020a03168152602001908152602001600020548282815181101515610ef657fe5b60209081029091010152600101610ea2565b60126020526000908152604090205481565b600e60205260009081526040902054600160a060020a031681565b600a60209081526000928352604080842090915290825290205460ff1681565b60013360009081526003602052604090205414610f7157600080fd5b600081815260076020908152604080832033845290915290205460ff1615610f9857600080fd5b60009081526006602090815260408083208054600190810190915560078352818420338552909252909120805460ff19169091179055565b601f5481565b6017546040517f50859fd9000000000000000000000000000000000000000000000000000000008152600091600160a060020a03169081906350859fd990611022908690600401612846565b602060405180830381600087803b15801561103c57600080fd5b505af1158015611050573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052506110749190810190612639565b9392505050565b601d5481565b600d60205260009081526040902054600160a060020a031681565b600080600133600090815260036020526040902054146110bb57600080fd5b6000848152600a6020908152604080832033845290915290205460ff16156110e257600080fd5b506000838152600a602090815260408083203384529091529020805460ff19166001908117909155601754600160a060020a03169083151514156111d2576000848152600860205260409020805460010190819055601954136111cd576000848152600d6020526040908190205490517f11f79f7c000000000000000000000000000000000000000000000000000000008152600160a060020a039182169350908216906311f79f7c9061119a908590600401612846565b600060405180830381600087803b1580156111b457600080fd5b505af11580156111c8573d6000803e3d6000fd5b505050505b61127f565b60008481526009602052604090208054600101908190556019541361127f576000848152600e6020526040908190205490517f11f79f7c000000000000000000000000000000000000000000000000000000008152600160a060020a039182169350908216906311f79f7c9061124c908590600401612846565b600060405180830381600087803b15801561126657600080fd5b505af115801561127a573d6000803e3d6000fd5b505050505b336000908152601060205260409020548413156112a9573360009081526010602052604090208490555b50505050565b60116020526000908152604090205481565b60096020526000908152604090205481565b601460209081526000928352604080842090915290825290205481565b60106020526000908152604090205481565b600f6020908152600091825260409182902080548351601f600260001961010060018616150201909316929092049182018490048402810184019094528084529092918391908301828280156113995780601f1061136e57610100808354040283529160200191611399565b820191906000526020600020905b81548152906001019060200180831161137c57829003601f168201915b505050505090806001018054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156114375780601f1061140c57610100808354040283529160200191611437565b820191906000526020600020905b81548152906001019060200180831161141a57829003601f168201915b50505060028085018054604080516020601f60001961010060018716150201909416959095049283018590048502810185019091528181529596959450909250908301828280156114c95780601f1061149e576101008083540402835291602001916114c9565b820191906000526020600020905b8154815290600101906020018083116114ac57829003601f168201915b5050505060038301805460408051602060026001851615610100026000190190941693909304601f81018490048402820184019092528181529495949350908301828280156115595780601f1061152e57610100808354040283529160200191611559565b820191906000526020600020905b81548152906001019060200180831161153c57829003601f168201915b5050505060048301805460408051602060026001851615610100026000190190941693909304601f81018490048402820184019092528181529495949350908301828280156115e95780601f106115be576101008083540402835291602001916115e9565b820191906000526020600020905b8154815290600101906020018083116115cc57829003601f168201915b5050505060058301546006909301549192600160a060020a039081169216905087565b600080806001336000908152600360205260409020541461162c57600080fd5b600160a060020a038416600090815260136020908152604080832054601d54601290935292205443955091935013801561166b5750601f54601e548403135b156112a957600160a060020a0384166000908152601560209081526040808320858452825280832033845290915290205460ff1615156116f857600160a060020a03841660008181526014602090815260408083208684528252808320805460019081019091559383526015825280832086845282528083203384529091529020805460ff191690911790555b601954600160a060020a0385166000908152601460209081526040808320868452909152902054106112a957506017546040517f11f79f7c000000000000000000000000000000000000000000000000000000008152600160a060020a039091169081906311f79f7c90611770908790600401612846565b600060405180830381600087803b15801561178a57600080fd5b505af1158015610e5a573d6000803e3d6000fd5b601e5481565b600160a060020a0381166000908152601060205260409020545b919050565b600160a060020a03811660009081526004602090815260409182902080548351601f60026000196101006001861615020190931692909204918201849004840281018401909452808452606093928301828280156118625780601f1061183757610100808354040283529160200191611862565b820191906000526020600020905b81548152906001019060200180831161184557829003601f168201915b50505050509050919050565b6118766121e9565b6000828152600f602090815260409182902082518154600260018216156101009081026000190190921604601f81018590049094028201810190945260e081018381529093919284928491908401828280156119135780601f106118e857610100808354040283529160200191611913565b820191906000526020600020905b8154815290600101906020018083116118f657829003601f168201915b50505050508152602001600182018054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156119b55780601f1061198a576101008083540402835291602001916119b5565b820191906000526020600020905b81548152906001019060200180831161199857829003601f168201915b5050509183525050600282810180546040805160206001841615610100026000190190931694909404601f81018390048302850183019091528084529381019390830182828015611a475780601f10611a1c57610100808354040283529160200191611a47565b820191906000526020600020905b815481529060010190602001808311611a2a57829003601f168201915b505050918352505060038201805460408051602060026001851615610100026000190190941693909304601f8101849004840282018401909252818152938201939291830182828015611adb5780601f10611ab057610100808354040283529160200191611adb565b820191906000526020600020905b815481529060010190602001808311611abe57829003601f168201915b505050918352505060048201805460408051602060026001851615610100026000190190941693909304601f8101849004840282018401909252818152938201939291830182828015611b6f5780601f10611b4457610100808354040283529160200191611b6f565b820191906000526020600020905b815481529060010190602001808311611b5257829003601f168201915b50505091835250506005820154600160a060020a03908116602083015260069092015490911660409091015292915050565b601654600160a060020a031681565b601954600082815260066020526040812054909113611bd1575060016117be565b506000919050565b600160a060020a03811660009081526005602090815260409182902080548351601f60026000196101006001861615020190931692909204918201849004840281018401909452808452606093928301828280156118625780601f1061183757610100808354040283529160200191611862565b60086020526000908152604090205481565b60195481565b60036020526000908152604090205481565b601c5481565b600760209081526000928352604080842090915290825290205460ff1681565b6000908152600b60205260408120541390565b601854600160a060020a03165b90565b60136020526000908152604090205481565b601b5481565b601654600160a060020a03163314611cef57600080fd5b60178054600160a060020a031916600160a060020a0392909216919091179055565b60013360009081526003602052604090205414611d2d57611d99565b3360009081526004602090815260409091208351611d4d9285019061216b565b503360009081526005602090815260409091208251611d6e9284019061216b565b50601b8054600101908190553360009081526012602090815260408083209390935560139052204390555b5050565b601a5481565b601654600160a060020a03163314611dba57600080fd5b601f55565b60066020526000908152604090205481565b601754600160a060020a031690565b601560209081526000938452604080852082529284528284209052825290205460ff1681565b601754600160a060020a0316331480611e295750601654600160a060020a031633145b1515611e3457600080fd5b6001600160a060020a0382166000908152600360205260409020541415610aa057600160a060020a0316600090815260036020526040902060029055601b80546001019055565b601754600160a060020a0316331480611e9e5750601654600160a060020a031633145b1515611ea957600080fd5b60188054600160a060020a031916331790556000600160a060020a0382166000908152600360205260409020541415611f3557601a8054600160a060020a0383166000818152600160208181526040808420869055948352600281528483208054600160a060020a03191685179055855482019095559181526003909352912055601b54601d5543601e555b6002600160a060020a0382166000908152600360205260409020541415610aa05760015b600160a060020a038216600090815260036020526040902055601b54601d5543601e5550565b606060006060600080611f90610958565b935083604051908082528060200260200182016040528015611fbc578160200160208202803883390190505b50925060009150600090505b601a5481121561204e576001600082815260026020908152604080832054600160a060020a0316835260039091529020541415612046576000818152600260205260409020548351600160a060020a039091169084908490811061202857fe5b600160a060020a039092166020928302909101909101526001909101905b600101611fc8565b50909392505050565b601754600160a060020a031633148061207a5750601654600160a060020a031633145b151561208557600080fd5b60188054600160a060020a03191633179055600160a060020a0391909116600090815260208190526040902055565b601654600160a060020a031633146120cb57600080fd5b601955601b80546001019055565b601754600160a060020a03163314806120fc5750601654600160a060020a031633145b151561210757600080fd5b60188054600160a060020a031916331790556001600160a060020a0382166000908152600360205260409020541415610aa0576002611f59565b600160a060020a031660009081526001602052604090205490565b601754600160a060020a031681565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f106121ac57805160ff19168380011785556121d9565b828001600101855582156121d9579182015b828111156121d95782518255916020019190600101906121be565b506121e5929150612239565b5090565b60e06040519081016040528060608152602001606081526020016060815260200160608152602001606081526020016000600160a060020a031681526020016000600160a060020a031681525090565b611cbd91905b808211156121e5576000815560010161223f565b600061107482356129e9565b6000601f8201831361227057600080fd5b813561228361227e82612996565b61296f565b915081818352602084019350602081019050838560208402820111156122a857600080fd5b60005b838110156122d457816122be8882612253565b84525060209283019291909101906001016122ab565b5050505092915050565b600061107482356129f5565b600061107482516129f5565b60006110748235611cbd565b6000601f8201831361231357600080fd5b813561232161227e826129b7565b9150808252602083016020830185838301111561233d57600080fd5b6123488382846129fa565b50505092915050565b60006110748251611cbd565b60006020828403121561236f57600080fd5b600061237b8484612253565b949350505050565b6000806040838503121561239657600080fd5b60006123a28585612253565b92505060206123b3858286016122f6565b9150509250929050565b60008060008060008060c087890312156123d657600080fd5b60006123e28989612253565b965050602087013567ffffffffffffffff8111156123ff57600080fd5b61240b89828a01612302565b955050604087013567ffffffffffffffff81111561242857600080fd5b61243489828a01612302565b945050606087013567ffffffffffffffff81111561245157600080fd5b61245d89828a01612302565b935050608087013567ffffffffffffffff81111561247a57600080fd5b61248689828a01612302565b92505060a087013567ffffffffffffffff8111156124a357600080fd5b6124af89828a01612302565b9150509295509295509295565b6000806000606084860312156124d157600080fd5b60006124dd8686612253565b93505060206124ee868287016122f6565b92505060406124ff86828701612253565b9150509250925092565b60006020828403121561251b57600080fd5b813567ffffffffffffffff81111561253257600080fd5b61237b8482850161225f565b60006020828403121561255057600080fd5b600061237b84846122ea565b60006020828403121561256e57600080fd5b600061237b84846122f6565b6000806040838503121561258d57600080fd5b823567ffffffffffffffff8111156125a457600080fd5b6125b085828601612302565b925050602083013567ffffffffffffffff8111156125cd57600080fd5b6123b385828601612302565b600080604083850312156125ec57600080fd5b60006125f885856122f6565b92505060206123b385828601612253565b6000806040838503121561261c57600080fd5b600061262885856122f6565b92505060206123b3858286016122de565b60006020828403121561264b57600080fd5b600061237b8484612351565b612660816129e9565b82525050565b6000612671826129e5565b808452602084019350612683836129df565b60005b828110156126b357612699868351612657565b6126a2826129df565b602096909601959150600101612686565b5093949350505050565b60006126c8826129e5565b8084526020840193506126da836129df565b60005b828110156126b3576126f0868351612760565b6126f9826129df565b6020969096019591506001016126dd565b6000612715826129e5565b808452602084019350612727836129df565b60005b828110156126b35761273d868351612760565b612746826129df565b60209690960195915060010161272a565b612660816129f5565b61266081611cbd565b6000612774826129e5565b808452612788816020860160208601612a06565b61279181612a32565b9093016020019392505050565b805160e0808452600091908401906127b68282612769565b915050602083015184820360208601526127d08282612769565b915050604083015184820360408601526127ea8282612769565b915050606083015184820360608601526128048282612769565b9150506080830151848203608086015261281e8282612769565b91505060a083015161283360a0860182612657565b5060c0830151610b5860c0860182612657565b602081016128548284612657565b92915050565b604081016128688285612657565b6110746020830184612760565b602080825281016110748184612666565b6020808252810161107481846126bd565b60208082528101611074818461270a565b602081016128548284612757565b602080825281016110748184612769565b60e080825281016128d8818a612769565b905081810360208301526128ec8189612769565b905081810360408301526129008188612769565b905081810360608301526129148187612769565b905081810360808301526129288186612769565b905061293760a0830185612657565b61294460c0830184612657565b98975050505050505050565b602081016128548284612760565b60208082528101611074818461279e565b60405181810167ffffffffffffffff8111828210171561298e57600080fd5b604052919050565b600067ffffffffffffffff8211156129ad57600080fd5b5060209081020190565b600067ffffffffffffffff8211156129ce57600080fd5b506020601f91909101601f19160190565b60200190565b5190565b600160a060020a031690565b151590565b82818337506000910152565b60005b83811015612a21578181015183820152602001612a09565b838111156112a95750506000910152565b601f01601f1916905600a265627a7a72305820e6a9d025cfe2e544512893290f99ebd24855865c7dfe21b4ec6cb496c03f4c056c6578706572696d656e74616cf50037', 
     gas: '4700000'
   }
 )

console.log("VSS contract is being deployed at transaction HASH: " + vssbase.transactionHash);

// Check for the two POO contract deployments
var vnodePoolAddr = waitBlock(vnodepoolbase.transactionHash);
var scsPoolAddr = waitBlock(scspoolbase.transactionHash);
var vssAddr = waitBlock(vssbase.transactionHash);


vnodePool = vnodepoolbaseContract.at(vnodePoolAddr);
scsPool = scspoolbaseContract.at(scsPoolAddr);
vss = vssbaseContract.at(vssAddr);

console.log("VNODE pool contract address:", vnodePool.address);
console.log("SCS pool contract address:", scsPool.address);
console.log("VSS contract address:", vss.address);
console.log("Please use the mined contract addresses in deploying the RandDrop AppChain!!!")


//===============Step 2. Use the deployed Contracts to start a AppChain======

// Deploy the AppChain contract to form a AppChain with Atomic Swap of Token (ASM) function
var min = 1 ;           //Min SCSs required in the AppChain, only 1,3,5,7 should be used`
var max = 11 ;          //Max SCSs needed in the AppChain, Only 11, 21, 31, 51, 99
var thousandth = 1000 ; //Fixed, do not need change
var flushRound = 60 ;   //Number of MotherChain rounds, must between 40 and 500

// these address should be pass from Step 1. If you use previously deployed contract, then input the address here.
// var scsPoolAddr = vnodePool.address;
// var vnodePoolAddr = scsPool.address;
// var vssAddr =  vss.address;

var tokensupply = 996;// AppChain token amount, used to exchange for native token, should 
var exchangerate = 10;// the exchange rate bewteen moac and AppChain token.

// For deploy the AppChain contract, need to optimize the output size of the contract
// need to set to 1
var appchainASMContract = chain3.mc.contract([{"constant":false,"inputs":[{"name":"newVssBase","type":"address"}],"name":"setVssBase","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"maxMember","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"maxFlushInRound","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"blockReward","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"per_upload_redeemdata_num","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"pendingFlushIndex","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"index","type":"uint256"}],"name":"removeSyncNode","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"addr","type":"address"}],"name":"vssSlash","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"indexInlist","type":"uint256"},{"name":"hashlist","type":"bytes32[]"},{"name":"blocknum","type":"uint256[]"},{"name":"distAmount","type":"uint256[]"},{"name":"badactors","type":"uint256[]"},{"name":"viaNodeAddress","type":"address"},{"name":"preRedeemNum","type":"uint256"}],"name":"createProposal","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"BALANCE","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"","type":"uint256"}],"name":"nodeList","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"getMonitorInfo","outputs":[{"name":"","type":"address[]"},{"name":"","type":"string[]"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"nodeToReleaseCount","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"scsBeneficiary","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"minMember","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"funcCode","outputs":[{"name":"","type":"bytes"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"senderType","type":"uint256"},{"name":"index","type":"uint256"}],"name":"requestReleaseImmediate","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"senderType","type":"uint256"},{"name":"index","type":"uint256"}],"name":"requestRelease","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"consensusFlag","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"index","type":"uint256"}],"name":"BackupUpToDate","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"","type":"bytes32"}],"name":"proposals","outputs":[{"name":"proposedBy","type":"address"},{"name":"lastApproved","type":"bytes32"},{"name":"hash","type":"bytes32"},{"name":"start","type":"uint256"},{"name":"end","type":"uint256"},{"name":"flag","type":"uint256"},{"name":"startingBlock","type":"uint256"},{"name":"votecount","type":"uint256"},{"name":"viaNodeAddress","type":"address"},{"name":"preRedeemNum","type":"uint256"},{"name":"distributeFlag","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"num","type":"uint256"}],"name":"updatePerUploadRedeemNum","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"","type":"uint256"}],"name":"nodesToDispel","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"getVnodeInfo","outputs":[{"components":[{"name":"protocol","type":"address"},{"name":"members","type":"uint256[]"},{"name":"rewards","type":"uint256[]"},{"name":"proposalExpiration","type":"uint256"},{"name":"VnodeProtocolBaseAddr","type":"address"},{"name":"penaltyBond","type":"uint256"},{"name":"subchainstatus","type":"uint256"},{"name":"owner","type":"address"},{"name":"BALANCE","type":"uint256"},{"name":"redeems","type":"uint256[]"},{"name":"nodeList","type":"address[]"},{"name":"nodesToJoin","type":"address[]"}],"name":"","type":"tuple"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[],"name":"setOwner","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"getBlockNumber","outputs":[{"name":"","type":"int256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[],"name":"close","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"","type":"uint256"}],"name":"monitors","outputs":[{"name":"from","type":"address"},{"name":"bond","type":"uint256"},{"name":"link","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"txReward","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"monitor","type":"address"},{"name":"link","type":"string"}],"name":"registerAsMonitor","outputs":[],"payable":true,"stateMutability":"payable","type":"function"},{"constant":true,"inputs":[{"name":"scs","type":"address"}],"name":"getSCSRole","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"indexInlist","type":"uint256"},{"name":"hash","type":"bytes32"},{"name":"redeem","type":"bool"}],"name":"voteOnProposal","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"nodesWatching","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[],"name":"registerOpen","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"getVssBase","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"max_redeemdata_num","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[],"name":"rebuildFromLastFlushPoint","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"num","type":"uint256"}],"name":"updatePerRedeemNum","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[],"name":"registerClose","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"currentRefundGas","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[],"name":"buyMintToken","outputs":[{"name":"","type":"bool"}],"payable":true,"stateMutability":"payable","type":"function"},{"constant":false,"inputs":[{"name":"num","type":"uint256"}],"name":"updateRechargeCycle","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"nodeCount","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"id","type":"address"},{"name":"link","type":"string"}],"name":"addSyncNode","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"beneficiary","type":"address"},{"name":"v","type":"uint8"},{"name":"r","type":"bytes32"},{"name":"s","type":"bytes32"},{"name":"publickey","type":"bytes32"}],"name":"registerAsBackup","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"curFlushIndex","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"per_recharge_num","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"AUTO_RETIRE","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"penaltyBond","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"getholdingPool","outputs":[{"name":"","type":"address[]"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"beneficiary","type":"address"},{"name":"v","type":"uint8"},{"name":"r","type":"bytes32"},{"name":"s","type":"bytes32"},{"name":"publickey","type":"bytes32"}],"name":"registerAsSCS","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"protocol","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"MONITOR_JOIN_FEE","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"totalBond","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"lastFlushBlk","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"recharge_cycle","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[],"name":"addFund","outputs":[],"payable":true,"stateMutability":"payable","type":"function"},{"constant":true,"inputs":[],"name":"per_redeemdata_num","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"vssbase","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"contractNeedFund","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"","type":"uint256"}],"name":"nodesToJoin","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"","type":"address"}],"name":"nodePerformance","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"num","type":"uint256"}],"name":"updatePerRechargeNum","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"getFlushStatus","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"viaReward","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"userAddr","type":"address"},{"name":"holdingPoolPos","type":"uint256"}],"name":"getEnteringAmount","outputs":[{"name":"enteringAddr","type":"address[]"},{"name":"enteringAmt","type":"uint256[]"},{"name":"enteringtime","type":"uint256[]"},{"name":"rechargeParam","type":"uint256[]"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"totalExchange","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"userAddr","type":"address"}],"name":"getRedeemRecords","outputs":[{"components":[{"name":"redeemAmount","type":"uint256[]"},{"name":"redeemtime","type":"uint256[]"}],"name":"","type":"tuple"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"addr","type":"address"},{"name":"index1","type":"uint8"},{"name":"index2","type":"uint8"}],"name":"matchSelTarget","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"priceOneGInMOAC","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"nodeToAdd","type":"uint256"}],"name":"registerAdd","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"MAX_DELETE_NUM","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"","type":"uint256"}],"name":"syncNodes","outputs":[{"name":"nodeId","type":"address"},{"name":"link","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"getFlushInfo","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"index","type":"uint256"}],"name":"getEstFlushBlock","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"syncReward","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"hash","type":"bytes32"}],"name":"checkProposalStatus","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"types","type":"uint256"}],"name":"getProposal","outputs":[{"components":[{"name":"proposedBy","type":"address"},{"name":"lastApproved","type":"bytes32"},{"name":"hash","type":"bytes32"},{"name":"start","type":"uint256"},{"name":"end","type":"uint256"},{"name":"distributionAmount","type":"uint256[]"},{"name":"flag","type":"uint256"},{"name":"startingBlock","type":"uint256"},{"name":"voters","type":"uint256[]"},{"name":"votecount","type":"uint256"},{"name":"badActors","type":"uint256[]"},{"name":"viaNodeAddress","type":"address"},{"name":"preRedeemNum","type":"uint256"},{"name":"redeemAddr","type":"address[]"},{"name":"redeemAmt","type":"uint256[]"},{"name":"minerAddr","type":"address[]"},{"name":"distributeFlag","type":"uint256"},{"name":"redeemAgreeList","type":"address[]"}],"name":"","type":"tuple"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"proposalHashInProgress","outputs":[{"name":"","type":"bytes32"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"hash","type":"bytes32"}],"name":"requestEnterAndRedeemAction","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"","type":"uint256"}],"name":"nodesToRelease","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[{"name":"","type":"uint256"}],"name":"randIndex","outputs":[{"name":"","type":"uint8"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"indexInlist","type":"uint256"},{"name":"hash","type":"bytes32"}],"name":"requestProposalAction","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"name":"addr","type":"address"}],"name":"isMemberValid","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"joinCntNow","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"AUTO_RETIRE_COUNT","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"initialFlushInRound","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"selTarget","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[],"name":"reset","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"proposalHashApprovedLast","outputs":[{"name":"","type":"bytes32"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"NODE_INIT_PERFORMANCE","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"VnodeProtocolBaseAddr","outputs":[{"name":"","type":"address"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"redeemAddr","type":"address[]"},{"name":"redeemAmt","type":"uint256[]"}],"name":"UploadRedeemData","outputs":[{"name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"name":"monitor","type":"address"}],"name":"removeMonitorInfo","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"MAX_GAS_PRICE","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"joinCntMax","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"dappRedeemPos","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"proposalExpiration","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"DEFLATOR_VALUE","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"MONITOR_MIN_FEE","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"name":"recv","type":"address"},{"name":"amount","type":"uint256"}],"name":"withdraw","outputs":[],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"txNumInFlush","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"totalOperation","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"flushInRound","outputs":[{"name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"inputs":[{"name":"scsPoolAddr","type":"address"},{"name":"vnodeProtocolBaseAddr","type":"address"},{"name":"min","type":"uint256"},{"name":"max","type":"uint256"},{"name":"thousandth","type":"uint256"},{"name":"flushRound","type":"uint256"},{"name":"tokensupply","type":"uint256"},{"name":"exchangerate","type":"uint256"},{"name":"vssbaseAddr","type":"address"}],"payable":false,"stateMutability":"nonpayable","type":"constructor"},{"payable":true,"stateMutability":"payable","type":"fallback"},{"anonymous":false,"inputs":[{"indexed":false,"name":"message","type":"string"}],"name":"ReportStatus","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"name":"addr","type":"address"},{"indexed":false,"name":"amount","type":"uint256"}],"name":"TransferAmount","type":"event"}]);

var appChain;

// Need to use callback function, otherwise this process may halt under Windows.

deploy_randdrop(  
   scsPoolAddr,
   vnodePoolAddr,
   min,
   max,
   thousandth,
   flushRound,
   tokensupply,
   exchangerate,
   vssAddr, 
   baseaddr).then((data) => {

	var appChainAddr = data
	appChain = appchainASMContract.at(appChainAddr);
	console.log(" **********  appChain Contract Address: " + appChainAddr );
	
	
  //setCaller(subchain)
  var setCallerData=vss.setCaller.getData(appChainAddr);
  console.log("Setup the RandDrop Appchain as VSS caller:", data);
  sendtx(baseaddr,vssAddr,'0',setCallerData);
  sleep(5000);
	//===============Step 3. Use the deployed Contracts to start a AppChain======

	// The deposit is required for each SCS to join the AppChain
	var appChainDeposit = 10;

	if (checkBalance(appChainAddr, appChainDeposit) ){
	   console.log("continue...")
	}else{
	   // Add balance to appChainAddr for AppChain running
	   console.log("Add funding to AppChain!");
	   addFundToAppChain(appChainAddr, appChainDeposit)
	   waitBalance(appChain.address, appChainDeposit);
	}

	if (checkBalance(VNODEVia, minVnodeDeposit)) {
	  console.log("VNODE has enough balance continue...")
		// sendtx(baseaddr,vnodecontractaddr,num,data)
	}else{
	  // Add balance
	  console.log("Add funding to VNODE!");
	  sendtx(baseaddr,VNODEVia,minVnodeDeposit);
	  waitBalance(VNODEVia, minVnodeDeposit);
	}


	// Check to make sure all SCSs have enough balance than the min deposit required by 
	// SCS pool
	for (var i = 0; i < scs.length; i++) {
	  if (checkBalance(scs[i], minScsDeposit)) {
		console.log("SCS has enough balance, continue...")
	  }else{
		// Add balance
		console.log("Add funding to SCS!");
		sendtx(baseaddr,scs[i],minScsDeposit);
		waitBalance(scs[i], minScsDeposit);
	  }
	}

  // put the VNODE in the pool to communicate the data in BaseChain
	vnoderegister(vnodePool, minVnodeDeposit, VNODEVia, vnodeConnectUrl)

	console.log("Registering SCS to the pool", scsPool.address);
	registerScsToPool(scsPool.address,minScsDeposit);

	// Check if the SCS pool have enough nodes registered
	while (true) {
		let count = scsPool.scsCount();
		if (count >= minScsRequired) {
		  console.log("registertopool has enough SCS " + count);
		  break;
		}
		console.log("Waiting registertopool, current SCS count=" + count);
		sleep(5000);
	}

	// Check the blocks
	let startnum = chain3.mc.blockNumber;
	while (true) {
		let number = chain3.mc.blockNumber;
		if (number > startnum + 5) {
		  console.log("reached target block number " + number);
		  break;
		}
		console.log("Waiting block number, current block number=" + number);
		sleep(8000);
	}


	// Open the register for the SCSs to join the AppChain
	registerOpen(appChain.address);
	while (true) {
		let count = appChain.nodeCount();
		if (count >= minScsRequired) {
		  console.log("registered SCS pool has enough SCS " + count);
		  break;
		}
		console.log("Waiting more SCSs to register to the pool, current SCS count=" + count);
		sleep(5000);
	}

  // Close the registration to let the AppChain start running
	registerClose(appChain.address);

	sleep(5000);

    //===============Step 4. Deploy the DappBase contract at the AppChain======
    console.log("AppChain is ready, prepare to deploy:", inDappFile, " on ", appChain.address);
        // Check the DAPP status after deploy, need to wait for several blocks
    // If successful, you should see the new DAPP address
    // Need to wait on the new AppChains to run for a while
    waitForAppChainBlocks(appChain.address,10);
    // Deploy the DappBasePublic contract to enable the Dapp deployment on the AppChain
    // Please notice this is to deploy to the AppChain
    var dappbasepublicBytecode = '0x606060405260068054600160a060020a03191633600160a060020a03161790556111368061002e6000396000f3006060604052600436106100985763ffffffff7c010000000000000000000000000000000000000000000000000000000060003504166310ba0499811461009d57806312df94121461010b57806331a06771146101e1578063442e95b11461023057806357058a33146103305780635b1222b4146103965780635b15270c146103c857806389739c5b14610480578063f2096c3b14610488575b600080fd5b34156100a857600080fd5b6100f7600460248135818101908301358060208181020160405190810160405280939291908181526020018383602002808284375094965050509235600160a060020a031692506104ad915050565b604051901515815260200160405180910390f35b341561011657600080fd5b6101df60048035906044602480359081019083013580602081810201604051908101604052809392919081815260200183836020028082843782019150505050505091908035906020019082018035906020019080806020026020016040519081016040528093929190818152602001838360200280828437820191505050505050919080359060200190820180359060200190808060200260200160405190810160405280939291908181526020018383602002808284375094965061050695505050505050565b005b34156101ec57600080fd5b6101df60046024813581810190830135806020818102016040519081016040528093929190818152602001838360200280828437509496506108ec95505050505050565b341561023b57600080fd5b610252600160a060020a0360043516602435610ad1565b60405180806020018060200180602001848103845287818151815260200191508051906020019060200280838360005b8381101561029a578082015183820152602001610282565b50505050905001848103835286818151815260200191508051906020019060200280838360005b838110156102d95780820151838201526020016102c1565b50505050905001848103825285818151815260200191508051906020019060200280838360005b83811015610318578082015183820152602001610300565b50505050905001965050505050505060405180910390f35b341561033b57600080fd5b610343610d6d565b60405160208082528190810183818151815260200191508051906020019060200280838360005b8381101561038257808201518382015260200161036a565b505050509050019250505060405180910390f35b34156103a157600080fd5b6103ac600435610dd6565b604051600160a060020a03909116815260200160405180910390f35b34156103d357600080fd5b6103e7600160a060020a0360043516610dfe565b604051808060200180602001838103835285818151815260200191508051906020019060200280838360005b8381101561042b578082015183820152602001610413565b50505050905001838103825284818151815260200191508051906020019060200280838360005b8381101561046a578082015183820152602001610452565b5050505090500194505050505060405180910390f35b6101df610f83565b341561049357600080fd5b61049b61100a565b60405190815260200160405180910390f35b6000805b83518110156104fa5782600160a060020a03168482815181106104d057fe5b90602001906020020151600160a060020a031614156104f257600191506104ff565b6001016104b1565b600091505b5092915050565b60008061056d600380548060200260200160405190810160405280929190818152602001828054801561056257602002820191906000526020600020905b8154600160a060020a03168152600190910190602001808311610544575b5050505050336104ad565b151561057857600080fd5b835185511461058657600080fd5b600b54861461059457600080fd5b8585858560405180858152602001848051906020019060200280838360005b838110156105cb5780820151838201526020016105b3565b50505050905001838051906020019060200280838360005b838110156105fb5780820151838201526020016105e3565b50505050905001828051906020019060200280838360005b8381101561062b578082015183820152602001610613565b5050505090500194505050505060405190819003902060008181526004602052604090206002015490925060ff1615610663576108e4565b6106e160046000846000191660001916815260200190815260200160002060010180548060200260200160405190810160405280929190818152602001828054801561056257602002820191906000526020600020908154600160a060020a03168152600190910190602001808311610544575050505050336104ad565b15156108e4576000828152600460205260409020600190810180549091810161070a8382611010565b506000918252602090912001805473ffffffffffffffffffffffffffffffffffffffff191633600160a060020a03161790556003546002906000848152600460205260409020600101549190049011156108e457506000818152600460205260408120600201805460ff191660011790555b84518110156108d85760078054600181016107978382611010565b916000526020600020900160008784815181106107b057fe5b906020019060200201518254600160a060020a039182166101009390930a92830291909202199091161790555060088054600181016107ef8382611010565b9160005260206000209001600086848151811061080857fe5b90602001906020020151909155505060098054600181016108298382611010565b506000918252602090912042910155600a80546001810161084a8382611010565b9160005260206000209001600085848151811061086357fe5b9060200190602002015190915550859050818151811061087f57fe5b90602001906020020151600160a060020a03166108fc8583815181106108a157fe5b906020019060200201519081150290604051600060405180830381858888f1935050505015156108d057600080fd5b60010161077c565b8451600b805490910190555b505050505050565b6006546000908190819033600160a060020a039081169116141561091f57600384805161091d929160200190611039565b505b8360405180828051906020019060200280838360005b8381101561094d578082015183820152602001610935565b5050505090500191505060405180910390209250600360405180828054801561099f57602002820191906000526020600020905b8154600160a060020a03168152600190910190602001808311610981575b50509150506040519081900390209150828214156109bc57610acb565b610a3760056000856000191660001916815260200190815260200160002080548060200260200160405190810160405280929190818152602001828054801561056257602002820191906000526020600020908154600160a060020a03168152600190910190602001808311610544575050505050336104ad565b9050801515610acb576000838152600560205260409020805460018101610a5e8382611010565b506000918252602090912001805473ffffffffffffffffffffffffffffffffffffffff191633600160a060020a031617905560028451811515610a9d57fe5b600085815260056020526040902054919004901115610acb576003848051610ac9929160200190611039565b505b50505050565b610ad96110ad565b610ae16110ad565b610ae96110ad565b600080610af46110ad565b610afc6110ad565b610b046110ad565b60009450849350600160a060020a038a1615610b74578893505b600054841015610b6f5760008054600160a060020a038c16919086908110610b4257fe5b600091825260209091200154600160a060020a03161415610b64576001909401935b600190930192610b1e565b610b80565b60005489900394909401935b84604051805910610b8e5750595b9080825280602002602001820160405250925084604051805910610baf5750595b9080825280602002602001820160405250915084604051805910610bd05750595b90808252806020026020018201604052509050600094508893505b600054841015610d5d57600160a060020a038a1615610ca55760008054600160a060020a038c16919086908110610c1e57fe5b600091825260209091200154600160a060020a03161415610ca0576001805485908110610c4757fe5b906000526020600020900154828681518110610c5f57fe5b602090810290910101526002805485908110610c7757fe5b906000526020600020900154818681518110610c8f57fe5b602090810290910101526001909401935b610d52565b6000805485908110610cb357fe5b600091825260209091200154600160a060020a0316838681518110610cd457fe5b600160a060020a039092166020928302909101909101526001805485908110610cf957fe5b906000526020600020900154828681518110610d1157fe5b602090810290910101526002805485908110610d2957fe5b906000526020600020900154818681518110610d4157fe5b602090810290910101526001909401935b600190930192610beb565b9199909850909650945050505050565b610d756110ad565b6003805480602002602001604051908101604052809291908181526020018280548015610dcb57602002820191906000526020600020905b8154600160a060020a03168152600190910190602001808311610dad575b505050505090505b90565b6003805482908110610de457fe5b600091825260209091200154600160a060020a0316905081565b610e066110ad565b610e0e6110ad565b600080610e196110ad565b610e216110ad565b60009250600093505b600b54841015610e7b5760078054600160a060020a038916919086908110610e4e57fe5b600091825260209091200154600160a060020a03161415610e70576001909201915b600190930192610e2a565b82604051805910610e895750595b9080825280602002602001820160405250915082604051805910610eaa5750595b9080825280602002602001820160405250905060009250600093505b600b54841015610f775760078054600160a060020a038916919086908110610eea57fe5b600091825260209091200154600160a060020a03161415610f6c576008805485908110610f1357fe5b906000526020600020900154828481518110610f2b57fe5b602090810290910101526009805485908110610f4357fe5b906000526020600020900154818481518110610f5b57fe5b602090810290910101526001909201915b600190930192610ec6565b90969095509350505050565b6000805460018101610f958382611010565b506000918252602090912001805473ffffffffffffffffffffffffffffffffffffffff191633600160a060020a031617905560018054808201610fd88382611010565b5060009182526020909120349101556002805460018101610ff98382611010565b506000918252602090912042910155565b600b5481565b815481835581811511611034576000838152602090206110349181019083016110bf565b505050565b82805482825590600052602060002090810192821561109d579160200282015b8281111561109d578251825473ffffffffffffffffffffffffffffffffffffffff1916600160a060020a039190911617825560209290920191600190910190611059565b506110a99291506110d9565b5090565b60206040519081016040526000815290565b610dd391905b808211156110a957600081556001016110c5565b610dd391905b808211156110a957805473ffffffffffffffffffffffffffffffffffffffff191681556001016110df5600a165627a7a7230582080204de5c86ad5f7a7ff60a40ee609308104cef33209c881c4f162330fd1481b0029';

    // Prepare and Send TX to VNODE to deploy the DAPP on the AppChain;
    //Deploy the DappBase with correct parameters
    var inNonce = chain3.scs.getNonce(appChain.address,baseaddr);

    console.log("Src nonce:", inNonce, " RandDrop AppChain TokenSupply", tokensupply);

    // set TX flag to '0x3' for deploy contract on the AppChain
    var mchash = sendAppChainTx(baseaddr,basepsd,appChain.address,SCSVia, tokensupply, dappbasepublicBytecode, inNonce,'0x3')
    console.log("dappbase TX HASH:", mchash);

    // Check the DAPP status after deploy, need to wait for several blocks
    // If successful, you should see the new DAPP address
    waitForAppChainBlocks(appChain.address,5);

    console.log("Should see DAPP list on :",appChain.address, "\n at: ", chain3.scs.getDappAddrList(appChain.address));

	console.log("all Done!!! Should see the blocks info on SCSs");
  // Lock the account after use
  chain3.personal.lockAccount(baseaddr);

	
    
}, (error) => {  console.log("deploy RandDropChainBaseASM error:" + error);});


//===============Utils Functions===============================================
// utils for the program
// Check if the input address has enough balance for the mc amount
function checkBalance(inaddr, inMcAmt) {
  if ( chain3.mc.getBalance(inaddr)/1e18 >= inMcAmt ){
    return true;
  }else{
    return false;
  }
}

function sendtx(src, tgtaddr, amount, strData) {

  chain3.mc.sendTransaction(
    {
      from: src,
      value:chain3.toSha(amount,'mc'),
      to: tgtaddr,
      gas: "2000000",
      gasPrice: chain3.mc.gasPrice,
      data: strData
    });
    
  console.log('sending from:' +   src + ' to:' + tgtaddr  + ' amount:' + amount + ' with data:' + strData);
}

// wait certain blocks on the BaseChain for the contract to be mined
function waitForBlocks(innum) {
  let startBlk = chain3.mc.blockNumber;
  let preBlk = startBlk;
  console.log("Waiting for blocks to confirm the contract... currently in block " + startBlk);
  while (true) {
    let curblk = chain3.mc.blockNumber;
    if (curblk > startBlk + innum) {
      console.log("Waited for " + innum + " blocks!");
      break;
    }
    if ( curblk > preBlk){
      console.log("Waiting for blocks to confirm the contract... currently in block " + curblk);
      preBlk = curblk;
    }else{
        console.log("...");
    }
    
    sleep(2000000);
  }
}

// wait one block on the BaseChain for the hash and return the receipt
function waitBlock(transactionHash) {
  console.log("Waiting a mined block to include your contract...");
  
  while (true) {
    let receipt = chain3.mc.getTransactionReceipt(transactionHash);
    if (receipt && receipt.contractAddress) {
      console.log("contract has been deployed at " + receipt.contractAddress);
      break;
    }
    console.log("block " + chain3.mc.blockNumber + "...");
    sleep(50000);
  }
  return chain3.mc.getTransactionReceipt(transactionHash).contractAddress;
}

// Wait until the account has enough balance
function waitBalance(addr, target) {
    while (true) {
        let balance = chain3.mc.getBalance(addr)/1000000000000000000;
        if (balance >= target) {
          console.log("account has enough balance " + balance);
          break;
        }
        console.log("Waiting the account has enough balance " + balance);
        sleep(5000);
    }
  }

function sleep(milliseconds) {
    var start = new Date().getTime();
    for (var i = 0; i < 1e7; i++) {
      if ((new Date().getTime() - start) > milliseconds){
        break;
      }
    }
}


//===============Utils TX to MicroChains=======================================

function registerScsToPool(proto, num){
  if ( num >= minScsDeposit){
    for( var i = 0;i<scs.length;i++){
      sendtx(baseaddr, proto, num,'0x4420e486000000000000000000000000' + scs[i].substr(2, 100));
    }
  }else{
    console.log("Cannot register SCSs with not enough deposit!", num);
  }

}

//Open the AppChain register process
function registerOpen(subchainaddr)
{
  sendtx(baseaddr, subchainaddr, '0','0x5defc56c' );
}

//Close the AppChain register process
function registerClose(subchainaddr)
{
  sendtx(baseaddr, subchainaddr, '0','0x69f3576f' );
}

// must do before flush
function addFundToAppChain(inaddr, num){
  sendtx(baseaddr, inaddr, num,'0xa2f09dfa')
}

// vnoderegister(viaAddress, 1, "127.0.0.1:50062")
// vnodepoolbase.vnodeCount()
// vnode - vnode pool contract object with register function, and address
// num - deposit for VNODE to join the VNODE pool
// data - VNODE register FUNCTION
function vnoderegister(vnode,num,via,ip){
  var data=vnode.register.getData(vnode.address,via.toLowerCase(),ip,'')
  sendtx(baseaddr,vnode.address,num,data)
}

// use precompiled code to create the contract
// Note the baseaddr account need to be unlocked
function deploy_randdrop(   
  scsPoolAddr,
   vnodeProtocolBaseAddr,
   min,
   max,
   thousandth,
   flushRound,
   tokensupply,
   exchangerate,
   vssbaseAddr, baseaddr) {
	return new Promise((resolve, reject) => {
		
	console.log("Start to deploy the RandDrop AppChain contract");

  //console.log(' scsPoolAddr: ', scsPoolAddr, ' vnodePoolAddr: ', vnodePoolAddr, ' min: ', min, ' max: ', max, ' thousandth: ', thousandth, ' flushRound: ', flushRound, ' tokensupply: ', tokensupply, ' exchangerate: ', exchangerate, ' baseaddr: ', baseaddr); 
    
		
  // Precompiled Contract to be deployed
  var subchainbase = appchainASMContract.new(
   scsPoolAddr,
   vnodeProtocolBaseAddr,
   min,
   max,
   thousandth,
   flushRound,
   tokensupply,
   exchangerate,
   vssbaseAddr,
   {
     from: baseaddr, 
     data: '0x60806040526018601655670de0b6b3a76400006017556601c6bf5263400060195564174876e800601a55662386f26fc10000601b55662386f26fc1000060275564e8d4a51000602c5564174876e800602d556404a817c800602e556050602f55600060315560fa60355560066036556005603a556000603b5560a0603c556082603d556101f4603e556101f4603f556064604055348015620000a057600080fd5b506040516101208062007c0e8339810180604052620000c39190810190620003d2565b60008760011480620000d55750876003145b80620000e15750876005145b80620000ed5750876007145b1515620000f957600080fd5b86600b1480620001095750866015145b8062000115575086601f145b80620001215750866033145b806200012d5750866063145b15156200013957600080fd5b602885101580156200014d57506101f48511155b15156200015957600080fd5b5060058490556006849055602b8054600160a060020a031916600160a060020a038a8116919091179091556040517fde42f13c0000000000000000000000000000000000000000000000000000000081528a9182169063de42f13c90620001c79089908c90600401620004f9565b602060405180830381600087803b158015620001e257600080fd5b505af1158015620001f7573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052506200021d9190810190620004a9565b60038190555080600160a060020a031663365bfb9e6040518163ffffffff167c0100000000000000000000000000000000000000000000000000000000028152600401600060405180830381600087803b1580156200027b57600080fd5b505af115801562000290573d6000803e3d6000fd5b505050600189905550600287905560008054600160a060020a031916600160a060020a038c161781556004908155600e8054600160a060020a03191633179055600580546040517fb8a167e6000000000000000000000000000000000000000000000000000000008152600160a060020a0385169363b8a167e6936200031993029101620004e3565b600060405180830381600087803b1580156200033457600080fd5b505af115801562000349573d6000803e3d6000fd5b5050600019600d555050670de0b6b3a7640000840260315560418390556011805461ffff19166101001790556000602a8190556030555060458054600160a060020a031916600160a060020a039290921691909117905550620005279650505050505050565b6000620003bd82516200051b565b9392505050565b6000620003bd825162000518565b60008060008060008060008060006101208a8c031215620003f257600080fd5b6000620004008c8c620003af565b9950506020620004138c828d01620003af565b9850506040620004268c828d01620003c4565b9750506060620004398c828d01620003c4565b96505060806200044c8c828d01620003c4565b95505060a06200045f8c828d01620003c4565b94505060c0620004728c828d01620003c4565b93505060e0620004858c828d01620003c4565b925050610100620004998c828d01620003af565b9150509295985092959850929598565b600060208284031215620004bc57600080fd5b6000620004ca8484620003c4565b949350505050565b620004dd8162000518565b82525050565b60208101620004f38284620004d2565b92915050565b60408101620005098285620004d2565b620003bd6020830184620004d2565b90565b600160a060020a031690565b6176d780620005376000396000f3006080604052600436106104945763ffffffff60e060020a60003504166303d0592381146104ad57806303e3c9ac146104cd57806307289245146104f85780630ac168a11461050d5780630be6075a146105225780630d31454614610537578063110afc0f1461054c57806311f79f7c1461056c5780631463ef071461058c57806315e9977e146105b9578063208f2a31146105ce57806321a1b495146105fb57806326009deb1461061e5780632ad0f79b146106335780632b114a7c146106535780632da0371914610668578063301b48871461068a57806330be5944146106aa57806330e7f8ef146106ca578063312e014b146106df57806332ed5b12146106ff5780633a46492a146107365780633b082706146107565780633c1f16aa1461077657806340caae061461079857806342cbb15c146107ad57806343d726d6146107c257806344a58781146107d757806346d63676146108065780634d13deae1461081b57806350859fd91461082e578063517549a01461084e57806357365df21461086e5780635defc56c1461088e5780635f5ffef0146108a35780635fd652db146108b8578063634eaea6146108cd578063689b00ed146108e257806369f3576f146109025780636b35d367146109175780636bbded70146109375780636d9817eb1461093f5780636da49b831461095f5780636f7e15da146109745780636f8c54b51461099457806376164fb6146109b4578063793ebd89146109c95780637a813833146109de57806383d6f697146109f35780638640c8b114610a085780638987392714610a2a5780638ce7442614610a4a578063950f787914610a5f5780639b09723e14610a745780639d3979a114610a895780639eb34e4314610a9e578063a2f09dfa14610ab3578063a53dae5914610abb578063a5824de114610ad0578063a7fc116114610ae5578063a94f7a7014610afa578063a9555e6c14610b1a578063aa7e298614610b3a578063ab3c7d8714610b5a578063b062a92714610b6f578063b19932c014610b84578063b55845e714610bb4578063b74c3eff14610bc9578063b859889614610bf6578063b8697fe214610c16578063be93f1b314610c2b578063bff92d7014610c4b578063c063d98714610c60578063c067247c14610c8e578063c20b124614610ca3578063c4474a5914610cc3578063c66da99714610cd8578063c7f758a814610cf8578063ca3b852f14610d25578063ca5e56aa14610d3a578063cae56d5814610d5a578063cbe5b2a414610d7a578063cc819ad014610da7578063d0fab88514610dc7578063d12ff2eb14610de7578063d4f79bd514610dfc578063d736b38214610e11578063d7c3dc5f14610e26578063d826f88f14610e3b578063db22ccad14610e50578063dc393c0914610e65578063dc82c54f14610e7a578063dcd338ca14610e8f578063df4b780d14610eaf578063e3bbb4f114610ecf578063e5df842514610ee4578063e9e150d014610ef9578063eba308f814610f0e578063f21df01214610f23578063f2faa2a614610f38578063f3fef3a314610f4d578063f9326cf514610f6d578063fae67d4014610f82578063fcac00bc14610f97575b600054600160a060020a031633146104ab57600080fd5b005b3480156104b957600080fd5b506104ab6104c8366004616b03565b610fac565b3480156104d957600080fd5b506104e2610fe5565b6040516104ef919061756a565b60405180910390f35b34801561050457600080fd5b506104e2610feb565b34801561051957600080fd5b506104e2610ff1565b34801561052e57600080fd5b506104e2610ff7565b34801561054357600080fd5b506104e2610ffd565b34801561055857600080fd5b506104ab610567366004616cea565b611003565b34801561057857600080fd5b506104ab610587366004616b03565b611108565b34801561059857600080fd5b506105ac6105a7366004616d26565b6111ec565b6040516104ef919061755c565b3480156105c557600080fd5b506104e261172c565b3480156105da57600080fd5b506105ee6105e9366004616cea565b611732565b6040516104ef919061736d565b34801561060757600080fd5b5061061061175a565b6040516104ef9291906174ea565b34801561062a57600080fd5b506104e2611903565b34801561063f57600080fd5b506105ee61064e366004616b03565b611909565b34801561065f57600080fd5b506104e2611924565b34801561067457600080fd5b5061067d61192a565b6040516104ef9190617578565b34801561069657600080fd5b506105ac6106a5366004616e22565b6119b8565b3480156106b657600080fd5b506105ac6106c5366004616e22565b611cd4565b3480156106d657600080fd5b506104e2611de0565b3480156106eb57600080fd5b506104ab6106fa366004616cea565b611de6565b34801561070b57600080fd5b5061071f61071a366004616cea565b611e3b565b6040516104ef9b9a9998979695949392919061739c565b34801561074257600080fd5b506104ab610751366004616cea565b611ea0565b34801561076257600080fd5b506104e2610771366004616cea565b611ebc565b34801561078257600080fd5b5061078b611edb565b6040516104ef91906175ab565b3480156107a457600080fd5b506104ab61236e565b3480156107b957600080fd5b506104e2612395565b3480156107ce57600080fd5b506104ab61239a565b3480156107e357600080fd5b506107f76107f2366004616cea565b612447565b6040516104ef93929190617460565b34801561081257600080fd5b506104e2612510565b6104ab610829366004616b29565b612516565b34801561083a57600080fd5b506104e2610849366004616b03565b612705565b34801561085a57600080fd5b506105ac610869366004616e41565b6128b7565b34801561087a57600080fd5b506104e2610889366004616b03565b612a2e565b34801561089a57600080fd5b506104ab612a40565b3480156108af57600080fd5b506105ee612a78565b3480156108c457600080fd5b506104e2612a87565b3480156108d957600080fd5b506104ab612a8d565b3480156108ee57600080fd5b506104ab6108fd366004616cea565b612aab565b34801561090e57600080fd5b506105ac612ac7565b34801561092357600080fd5b506104e2610932366004616b03565b612d12565b6105ac612d24565b34801561094b57600080fd5b506104ab61095a366004616cea565b612e36565b34801561096b57600080fd5b506104e2612e52565b34801561098057600080fd5b506104ab61098f366004616b29565b612e58565b3480156109a057600080fd5b506105ac6109af366004616bab565b612f14565b3480156109c057600080fd5b506104e261332b565b3480156109d557600080fd5b506104e2613331565b3480156109ea57600080fd5b506105ac613337565b3480156109ff57600080fd5b506104e261333c565b348015610a1457600080fd5b50610a1d613342565b6040516104ef91906174d9565b348015610a3657600080fd5b506105ac610a45366004616bab565b6133a7565b348015610a5657600080fd5b506105ee613769565b348015610a6b57600080fd5b506104e2613778565b348015610a8057600080fd5b506104e261377e565b348015610a9557600080fd5b506104e2613784565b348015610aaa57600080fd5b506104e261378a565b6104ab613790565b348015610ac757600080fd5b506104e261385c565b348015610adc57600080fd5b506105ee613862565b348015610af157600080fd5b506104e2613871565b348015610b0657600080fd5b506105ee610b15366004616cea565b613877565b348015610b2657600080fd5b506104e2610b35366004616b03565b613885565b348015610b4657600080fd5b506104ab610b55366004616cea565b613897565b348015610b6657600080fd5b506105ac6138b3565b348015610b7b57600080fd5b506104e26138d0565b348015610b9057600080fd5b50610ba4610b9f366004616b7b565b6138d6565b6040516104ef949392919061750f565b348015610bc057600080fd5b506104e2613bca565b348015610bd557600080fd5b50610be9610be4366004616b03565b613bd0565b6040516104ef919061759a565b348015610c0257600080fd5b506105ac610c11366004616c20565b613ca9565b348015610c2257600080fd5b506104e2613d64565b348015610c3757600080fd5b506104ab610c46366004616cea565b613d6a565b348015610c5757600080fd5b506104e2613e72565b348015610c6c57600080fd5b50610c80610c7b366004616cea565b613e78565b6040516104ef929190617440565b348015610c9a57600080fd5b506104e2613f3b565b348015610caf57600080fd5b506104e2610cbe366004616cea565b613f83565b348015610ccf57600080fd5b506104e2613fc8565b348015610ce457600080fd5b506104e2610cf3366004616cea565b613fce565b348015610d0457600080fd5b50610d18610d13366004616cea565b61402b565b6040516104ef9190617589565b348015610d3157600080fd5b506104e26146b5565b348015610d4657600080fd5b506105ac610d55366004616cea565b6146bb565b348015610d6657600080fd5b506104e2610d75366004616cea565b614a52565b348015610d8657600080fd5b50610d9a610d95366004616cea565b614a66565b6040516104ef91906175bc565b348015610db357600080fd5b506105ac610dc2366004616e22565b614a8d565b348015610dd357600080fd5b506105ac610de2366004616b03565b615157565b348015610df357600080fd5b506104e2615173565b348015610e0857600080fd5b506104e2615179565b348015610e1d57600080fd5b506104e261517e565b348015610e3257600080fd5b506104e2615184565b348015610e4757600080fd5b506104ab61518a565b348015610e5c57600080fd5b506104e26151b9565b348015610e7157600080fd5b506104e26151bf565b348015610e8657600080fd5b506105ee6151c4565b348015610e9b57600080fd5b506105ac610eaa366004616c6d565b6151d3565b348015610ebb57600080fd5b506104ab610eca366004616b03565b6153fc565b348015610edb57600080fd5b506104e26155e6565b348015610ef057600080fd5b506104e26155ec565b348015610f0557600080fd5b506104e26155f2565b348015610f1a57600080fd5b506104e26155f8565b348015610f2f57600080fd5b506104e26155fe565b348015610f4457600080fd5b506104e2615604565b348015610f5957600080fd5b506104ab610f68366004616b7b565b61560a565b348015610f7957600080fd5b506104e2615665565b348015610f8e57600080fd5b506104e261566b565b348015610fa357600080fd5b506104e2615671565b600e54600160a060020a03163314610fc357600080fd5b60458054600160a060020a031916600160a060020a0392909216919091179055565b60025481565b603f5481565b60195481565b603c5481565b600a5481565b600e54600160a060020a03163314801561101e575060295481105b151561102957600080fd5b60298054600019810190811061103b57fe5b906000526020600020906002020160298281548110151561105857fe5b60009182526020909120825460029283029091018054600160a060020a031916600160a060020a039092169190911781556001808401805492936110ad938386019360001990821615610100020116046164f5565b50506029805490915060001981019081106110c457fe5b6000918252602082206002909102018054600160a060020a0319168155906110ef6001830182616576565b505060298054906111049060001983016165ba565b5050565b604554600090600160a060020a0316331461112257600080fd5b600160a060020a038216600090815260126020526040812054111561115b57600160a060020a0382166000908152601260205260408120555b61116482615157565b151561110457506045546040517fde79b856000000000000000000000000000000000000000000000000000000008152600160a060020a0390911690819063de79b856906111b690859060040161736d565b600060405180830381600087803b1580156111d057600080fd5b505af11580156111e4573d6000803e3d6000fd5b505050505050565b6000806000805a9250600f548b1080156112275750601080548c90811061120f57fe5b600091825260209091200154600160a060020a031633145b151561123257600080fd5b61123b8b613f83565b431015801561125857506016546002026112548c613f83565b0143105b151561126357600080fd5b600f5488511461127257600080fd5b600f5460029004875110151561128757600080fd5b602e543a111561129657600080fd5b604354603754106112a657600080fd5b600160075460009081526013602052604090206006015414156113315760078054600090815260136020908152604080832060056006909101559254825282822054600160a060020a031682526012905290812054111561133157600754600090815260136020908152604080832054600160a060020a031683526012909152902080546000190190555b6008548a518b90600090811061134357fe5b602090810290910101511461135b576000935061171e565b61136433615677565b1515611373576000935061171e565b89600181518110151561138257fe5b6020908102909101015191506000808381526013602052604090206006015411156113b0576000935061171e565b60008281526013602052604081208054600160a060020a03191633178155600854600182015560020183905589518a919081106113e957fe5b60209081029091018101516000848152601390925260409091206003015588518990600190811061141657fe5b602090810290910181015160008481526013909252604082206004015590505b600f548110156114e0576000828152601360205260409020885160059091019089908390811061146257fe5b6020908102909101810151825460018101845560009384528284200155838252601390526040902060108054600f909201918390811061149e57fe5b600091825260208083209091015483546001818101865594845291909220018054600160a060020a031916600160a060020a0390921691909117905501611436565b60016000838152601360205260409020600601556114fd8b613f83565b60008381526013602090815260408220600781019390935560088301805460018181018355918452828420018f905560098401805482019055601190930180549384018155825281209091018054600160a060020a0319163317905590505b86518110156115b15760008281526013602052604090208751600a9091019088908390811061158757fe5b6020908102909101810151825460018181018555600094855292909320909201919091550161155c565b6000828152601360205260408120600b81018054600160a060020a031916600160a060020a038a16179055600c8101879055601001558415156116705760405160e560020a63010cee25028152600d9063219dc4a090611618903090600290600401617381565b602060405180830381600087803b15801561163257600080fd5b505af1158015611646573d6000803e3d6000fd5b505050506040513d601f19601f8201168201806040525061166a9190810190616ccc565b506116ee565b60405160e560020a63010cee25028152600d9063219dc4a09061169a903090600b90600401617381565b602060405180830381600087803b1580156116b457600080fd5b505af11580156116c8573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052506116ec9190810190616ccc565b505b6007829055600a8b90553a5a33600090815260146020526040902080549186036153ee0192909202019055600193505b505050979650505050505050565b60315481565b601080548290811061174057fe5b600091825260209091200154600160a060020a0316905081565b60608060006060806000603980549050935083604051908082528060200260200182016040528015611796578160200160208202803883390190505b509250836040519080825280602002602001820160405280156117cd57816020015b60608152602001906001900390816117b85790505b509150600090505b838110156118f85760398054829081106117eb57fe5b60009182526020909120600390910201548351600160a060020a039091169084908390811061181657fe5b600160a060020a03909216602092830290910190910152603980548290811061183b57fe5b600091825260209182902060026003909202018101805460408051601f6000196101006001861615020190931694909404918201859004850284018501905280835291929091908301828280156118d35780601f106118a8576101008083540402835291602001916118d3565b820191906000526020600020905b8154815290600101906020018083116118b657829003601f168201915b505050505082828151811015156118e657fe5b602090810290910101526001016117d5565b509094909350915050565b601c5481565b601860205260009081526040902054600160a060020a031681565b60015481565b600b805460408051602060026001851615610100026000190190941693909304601f810184900484028201840190925281815292918301828280156119b05780601f10611985576101008083540402835291602001916119b0565b820191906000526020600020905b81548152906001019060200180831161199357829003601f168201915b505050505081565b6000806000808560011415611a005760108054339190879081106119d857fe5b600091825260209091200154600160a060020a0316146119fb5760009350611ccb565b611a68565b8560021415611a5f5733600160a060020a031660186000601088815481101515611a2657fe5b6000918252602080832090910154600160a060020a03908116845290830193909352604090910190205416146119fb5760009350611ccb565b60009350611ccb565b601654600f54600554600d54019102600202014311611a8a5760009350611ccb565b6010805486908110611a9857fe5b6000918252602082200154905460175460405160e060020a63202cc5e1028152600160a060020a039384169650919092169350839163202cc5e191611ae1918791600401617381565b602060405180830381600087803b158015611afb57600080fd5b505af1158015611b0f573d6000803e3d6000fd5b505050506040513d601f19601f82011682018060405250611b339190810190616ccc565b505060455460405160e060020a63f06dc92d028152600160a060020a0390911690819063f06dc92d90611b6a90869060040161736d565b600060405180830381600087803b158015611b8457600080fd5b505af1158015611b98573d6000803e3d6000fd5b5050600f80546000190190819055601080549093509091508110611bb857fe5b60009182526020909120015460108054600160a060020a039092169187908110611bde57fe5b9060005260206000200160006101000a815481600160a060020a030219169083600160a060020a031602179055506010600f54815481101515611c1d57fe5b60009182526020909120018054600160a060020a03191690556010805490611c499060001983016165e6565b5060405160e560020a63010cee25028152600d9063219dc4a090611c739030908490600401617381565b602060405180830381600087803b158015611c8d57600080fd5b505af1158015611ca1573d6000803e3d6000fd5b505050506040513d601f19601f82011682018060405250611cc59190810190616ccc565b50600193505b50505092915050565b6000808360011415611d19576010805433919085908110611cf157fe5b600091825260209091200154600160a060020a031614611d145760009150611dd9565b611d81565b8360021415611d785733600160a060020a031660186000601086815481101515611d3f57fe5b6000918252602080832090910154600160a060020a0390811684529083019390935260409091019020541614611d145760009150611dd9565b60009150611dd9565b5060005b601c54811015611db65782601d8260058110611d9d57fe5b01541415611dae5760009150611dd9565b600101611d85565b82601d601c54600581101515611dc857fe5b0155601c8054600190810190915591505b5092915050565b60045481565b601554600214611df557600080fd5b6024805433919083908110611e0657fe5b600091825260209091200154600160a060020a031614611e2557600080fd5b5033600090815260126020526040902060059055565b601360205260009081526040902080546001820154600283015460038401546004850154600686015460078701546009880154600b890154600c8a01546010909a0154600160a060020a03998a169a989997989697959694959394929390911691908b565b600e54600160a060020a03163314611eb757600080fd5b603c55565b6023805482908110611eca57fe5b600091825260209091200154905081565b611ee361660a565b60008054600160a060020a03198116600160a060020a03909116178155604080516002808252606082810190935282918291816020016020820280388339019050509250600154836000815181101515611f3957fe5b60209081029091010152600254835184906001908110611f5557fe5b60209081029091018101919091528351611f7791600187019190860190616687565b50604080516003808252608082019092529060208201606080388339019050509150601954826000815181101515611fab57fe5b60209081029091010152601a54825183906001908110611fc757fe5b60209081029091010152601b54825183906002908110611fe357fe5b6020908102909101810191909152825161200591600287019190850190616687565b506016546003850155602b5460048086018054600160a060020a03938416600160a060020a03199182161790915560175460058801556030546006880155600e546007880180549190941691161790915560315460088601556040805182815260a081019091529060208201608080388339019050509050603b5481600081518110151561208f57fe5b60209081029091010152603c548151829060019081106120ab57fe5b60209081029091010152603d548151829060029081106120c757fe5b60209081029091010152603e548151829060039081106120e357fe5b6020908102909101810191909152815161210591600987019190840190616687565b506010805461211891600a8701916166c2565b506024805461212b91600b8701916166c2565b5060408051610180810182528554600160a060020a03168152600186018054835160208281028201810190955281815292938893818601939092909183018282801561219657602002820191906000526020600020905b815481526020019060010190808311612182575b50505050508152602001600282018054806020026020016040519081016040528092919081815260200182805480156121ee57602002820191906000526020600020905b8154815260200190600101908083116121da575b505050918352505060038201546020808301919091526004830154600160a060020a039081166040808501919091526005850154606085015260068501546080850152600785015490911660a0840152600884015460c084015260098401805482518185028101850190935280835260e090940193919290919083018282801561229757602002820191906000526020600020905b815481526020019060010190808311612283575b50505050508152602001600a82018054806020026020016040519081016040528092919081815260200182805480156122f957602002820191906000526020600020905b8154600160a060020a031681526001909101906020018083116122db575b50505050508152602001600b820180548060200260200160405190810160405280929190818152602001828054801561235b57602002820191906000526020600020905b8154600160a060020a0316815260019091019060200180831161233d575b50505050508152505094505b5050505090565b600e54600160a060020a0316151561239357600e8054600160a060020a031916331790555b565b435b90565b600e54600160a060020a031633146123b157600080fd5b60016030556007541515612393576005544303600d90815563219dc4a03060085b6040518363ffffffff1660e060020a0281526004016123f2929190617381565b602060405180830381600087803b15801561240c57600080fd5b505af1158015612420573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052506124449190810190616ccc565b50565b603980548290811061245557fe5b6000918252602091829020600391909102018054600180830154600280850180546040805161010096831615969096026000190190911692909204601f8101889004880285018801909252818452600160a060020a03909416965090949192918301828280156125065780601f106124db57610100808354040283529160200191612506565b820191906000526020600020905b8154815290600101906020018083116124e957829003601f168201915b5050505050905083565b601a5481565b6030541561252357600080fd5b602c5434101561253257600080fd5b600160a060020a0382166000908152602860205260409020541561255557600080fd5b600160a060020a038216151561256a57600080fd5b61257382612705565b60041480612587575061258582612705565b155b151561259257600080fd5b600160a060020a03828116600081815260286020908152604080832034908190556044805482019055815160608101835294855284830190815290840186815260398054600181018083559190955285517fdc16fef70f8d5ddbc01ee3d903d1e69c18a3c7be080eb86a81e0578814ee58d360039096029586018054600160a060020a0319169190981617875591517fdc16fef70f8d5ddbc01ee3d903d1e69c18a3c7be080eb86a81e0578814ee58d485015551805191959361267c937fdc16fef70f8d5ddbc01ee3d903d1e69c18a3c7be080eb86a81e0578814ee58d59091019291019061670e565b50600d925063219dc4a0915030905060065b6040518363ffffffff1660e060020a0281526004016126ae929190617381565b602060405180830381600087803b1580156126c857600080fd5b505af11580156126dc573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052506127009190810190616ccc565b505050565b600080805b60105482101561275c5783600160a060020a031660108381548110151561272d57fe5b600091825260209091200154600160a060020a0316141561275157600192506128b0565b60019091019061270a565b600160a060020a038416600090815260286020526040902054633b9aca001161278857600292506128b0565b600091505b6024548210156127df5783600160a060020a03166024838154811015156127b057fe5b600091825260209091200154600160a060020a031614156127d457600392506128b0565b60019091019061278d565b5060005460405160e060020a63ce9d9bd7028152600160a060020a0390911690819063ce9d9bd79061281590879060040161736d565b602060405180830381600087803b15801561282f57600080fd5b505af1158015612843573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052506128679190810190616ccc565b156128ab5761289d84601160005b60208104919091015460115460ff601f90931661010090810a90920483169291900416613ca9565b156128ab57600492506128b0565b600092505b5050919050565b6000806000805a6000878152601360205260409020600f54919450925087108015612903575060108054889081106128eb57fe5b600091825260209091200154600160a060020a031633145b151561290e57600080fd5b602e543a111561291d57600080fd5b61292633615677565b15156129355760009350612a24565b600160068301541461294a5760009350612a24565b4360165460020283600701540110156129665760009350612a24565b5060005b81600901548110156129aa5786826008018281548110151561298857fe5b906000526020600020015414156129a25760009350612a24565b60010161296a565b84156129d85760118201805460018101825560009182526020909120018054600160a060020a031916331790555b60088201805460018181018355600092835260209092200188905560098301805490910190553a5a33600090815260146020526040902080549186036153ee0192909202019055600193505b5050509392505050565b60286020526000908152604090205481565b60305415612a4d57600080fd5b600e54600160a060020a03163314612a6457600080fd5b6001601555600d63219dc4a03060006123d2565b604554600160a060020a031690565b603e5481565b600e54600160a060020a03163314612aa457600080fd5b6000600955565b600e54600160a060020a03163314612ac257600080fd5b603d55565b6000808080808060305414612adb57600080fd5b600e54600160a060020a03163314612af257600080fd5b6000601555604554600154600f54600160a060020a0390921695501115612c8257600054600f54600160a060020a03909116935091505b6000821115612c7457601080546000198401908110612b4457fe5b60009182526020909120015460175460405160e060020a63202cc5e1028152600160a060020a0392831693509185169163202cc5e191612b8991859190600401617381565b602060405180830381600087803b158015612ba357600080fd5b505af1158015612bb7573d6000803e3d6000fd5b505050506040513d601f19601f82011682018060405250612bdb9190810190616ccc565b5060405160e060020a63f06dc92d028152600160a060020a0385169063f06dc92d90612c0b90849060040161736d565b600060405180830381600087803b158015612c2557600080fd5b505af1158015612c39573d6000803e3d6000fd5b50505050601060018303815481101515612c4f57fe5b60009182526020909120018054600160a060020a031916905560001990910190612b29565b6000600f8190559450612367565b43600d908155600060095560405160e560020a63010cee2502815263219dc4a090612cb4903090600190600401617381565b602060405180830381600087803b158015612cce57600080fd5b505af1158015612ce2573d6000803e3d6000fd5b505050506040513d601f19601f82011682018060405250612d069190810190616ccc565b50600194505050505090565b60146020526000908152604090205481565b60415460425460315460009234029190038281831115612d8457604154828403811515612d4d57fe5b6040519190049150339082156108fc029083906000818181858888f19350505050158015612d7f573d6000803e3d6000fd5b508192505b60428054840190556032805460018181019092557f11df491316f14931039edfd4f8964c9a443b862f02d4c7611d18c2bc4e6ff697018054600160a060020a03191633179055603380548083019091557f82a75bdeeae8604d839476ae9efd8b0e15aa447e21bfd7f41283bb54e22c9a8201849055603480548083018255600091909152427f46bddb1178e94d7f2892ff5f366840eb658911794f2c3a44c450aa2c505186c190910155935050505090565b600e54600160a060020a03163314612e4d57600080fd5b603655565b600f5481565b600e54600160a060020a03163314612e6f57600080fd5b60408051808201909152600160a060020a0383811682526020808301848152602980546001810180835560009290925285517fcb7c14ce178f56e2e8d86ab33ebc0ae081ba8556a00cd122038841867181caac60029092029182018054600160a060020a0319169190961617855591518051919594936111e4937fcb7c14ce178f56e2e8d86ab33ebc0ae081ba8556a00cd122038841867181caad019291019061670e565b60008080808060305414612f2757600080fd5b612f3033612705565b600414612f3c57600080fd5b601554600214612f4f576000935061331f565b60005460405160e060020a63ce9d9bd7028152600160a060020a039091169350839063ce9d9bd790612f8590339060040161736d565b602060405180830381600087803b158015612f9f57600080fd5b505af1158015612fb3573d6000803e3d6000fd5b505050506040513d601f19601f82011682018060405250612fd79190810190616ccc565b1515612fe6576000935061331f565b612ff33360116000612875565b1515613002576000935061331f565b60255460265410613016576000935061331f565b600091505b600f5482101561306557601080543391908490811061303657fe5b600091825260209091200154600160a060020a0316141561305a576000935061331f565b60019091019061301b565b600091505b6024548210156130b457602480543391908490811061308557fe5b600091825260209091200154600160a060020a031614156130a9576000935061331f565b60019091019061306a565b6017546040517f6220fb1d000000000000000000000000000000000000000000000000000000008152600160a060020a03851691636220fb1d916131029133918d908d908d9060040161748d565b602060405180830381600087803b15801561311c57600080fd5b505af1158015613130573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052506131549190810190616ccc565b1515613163576000935061331f565b506024805460018181019092557f7cd332d19b93bcabe3cce7ca0c18a052f57e5fd03b4758a09f30f5ddc4b22ec4018054600160a060020a03191633908117909155602680549092019091556000818152601260205260408082209190915560455490517feefb4227000000000000000000000000000000000000000000000000000000008152600160a060020a039190911691829163eefb42279161320d918990600401617381565b600060405180830381600087803b15801561322757600080fd5b505af115801561323b573d6000803e3d6000fd5b50505050600160a060020a0389161515613274573360008181526018602052604090208054600160a060020a031916909117905561329d565b3360009081526018602052604090208054600160a060020a031916600160a060020a038b161790555b60405160e560020a63010cee25028152600d9063219dc4a0906132c7903090600790600401617381565b602060405180830381600087803b1580156132e157600080fd5b505af11580156132f5573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052506133199190810190616ccc565b50600193505b50505095945050505050565b60095481565b60355481565b600081565b60175481565b6060603260000180548060200260200160405190810160405280929190818152602001828054801561339d57602002820191906000526020600020905b8154600160a060020a0316815260019091019060200180831161337f575b5050505050905090565b600080808080603054146133ba57600080fd5b6133c333612705565b6004146133cf57600080fd5b6015546001146133e2576000935061331f565b60005460405160e060020a63ce9d9bd7028152600160a060020a039091169350839063ce9d9bd79061341890339060040161736d565b602060405180830381600087803b15801561343257600080fd5b505af1158015613446573d6000803e3d6000fd5b505050506040513d601f19601f8201168201806040525061346a9190810190616ccc565b1515613479576000935061331f565b6134863360116000612875565b1515613495576000935061331f565b600254600f5411156134aa576000935061331f565b600091505b600f548210156134f95760108054339190849081106134ca57fe5b600091825260209091200154600160a060020a031614156134ee576000935061331f565b6001909101906134af565b6017546040517f6220fb1d000000000000000000000000000000000000000000000000000000008152600160a060020a03851691636220fb1d916135479133918d908d908d9060040161748d565b602060405180830381600087803b15801561356157600080fd5b505af1158015613575573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052506135999190810190616ccc565b15156135a8576000935061331f565b506010805460018181019092557f1b6847dc741a1b0cd08d278845f9d819d87b734759afb55fe2de5cb82a9ae672018054600160a060020a03191633908117909155600f8054909201909155600081815260126020526040908190206005905560455490517feefb4227000000000000000000000000000000000000000000000000000000008152600160a060020a039190911691829163eefb422791613653918990600401617381565b600060405180830381600087803b15801561366d57600080fd5b505af1158015613681573d6000803e3d6000fd5b50506040517fe4c1de98000000000000000000000000000000000000000000000000000000008152600160a060020a038416925063e4c1de9891506136ca90339060040161736d565b600060405180830381600087803b1580156136e457600080fd5b505af11580156136f8573d6000803e3d6000fd5b50505050600160a060020a0389161515613731573360008181526018602052604090208054600160a060020a031916909117905561375a565b3360009081526018602052604090208054600160a060020a031916600160a060020a038b161790555b50600198975050505050505050565b600054600160a060020a031681565b60275481565b60445481565b600d5481565b60365481565b600e54600090600160a060020a031633146137aa57600080fd5b60438054340190819055603754101561244457506000603755601654600f54600554600d54019102600202014381116124445743600d90815560405160e560020a63010cee2502815263219dc4a09061380a903090600890600401617381565b602060405180830381600087803b15801561382457600080fd5b505af1158015613838573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052506111049190810190616ccc565b603d5481565b604554600160a060020a031681565b60375481565b602480548290811061174057fe5b60126020526000908152604090205481565b600e54600160a060020a031633146138ae57600080fd5b603555565b601654600f54600554600d540191026002020143811015905b5090565b601b5481565b606080808060008082808080600160a060020a038c161561394b578a95505b6032548610156139465760328054600160a060020a038e1691908890811061391957fe5b600091825260209091200154600160a060020a0316141561393b576001909401935b6001909501946138f5565b613954565b6032548b900394505b8460405190808252806020026020018201604052801561397e578160200160208202803883390190505b509350846040519080825280602002602001820160405280156139ab578160200160208202803883390190505b509250846040519080825280602002602001820160405280156139d8578160200160208202803883390190505b506040805160028082526060820183529294509190602083019080388339019050509050600094508a95505b603254861015613b7f57600160a060020a038c1615613ac05760328054600160a060020a038e16919088908110613a3757fe5b600091825260209091200154600160a060020a03161415613abb576033805487908110613a6057fe5b90600052602060002001548386815181101515613a7957fe5b602090810290910101526034805487908110613a9157fe5b90600052602060002001548286815181101515613aaa57fe5b602090810290910101526001909401935b613b74565b6032805487908110613ace57fe5b6000918252602090912001548451600160a060020a0390911690859087908110613af457fe5b600160a060020a039092166020928302909101909101526033805487908110613b1957fe5b90600052602060002001548386815181101515613b3257fe5b602090810290910101526034805487908110613b4a57fe5b90600052602060002001548286815181101515613b6357fe5b602090810290910101526001909401935b600190950194613a04565b603554816000815181101515613b9157fe5b60209081029091010152603654815182906001908110613bad57fe5b6020908102919091010152929b919a509850909650945050505050565b60425481565b613bd861677b565b600160a060020a0382166000908152603860209081526040918290208251815460609381028201840185529381018481529093919284928491840182828015613c4057602002820191906000526020600020905b815481526020019060010190808311613c2c575b5050505050815260200160018201805480602002602001604051908101604052809291908181526020018280548015613c9857602002820191906000526020600020905b815481526020019060010190808311613c84575b50505050508152505090505b919050565b6000806000613cb9868686615732565b9150613cc6308686615732565b905060035460ff1415613cdc5760019250613d5b565b808210613d255760035481830311613cf75760019250613d5b565b600060035482031015613d1c576003546101000381830310613d1c5760019250613d5b565b60009250613d5b565b60035482820311613d395760019250613d5b565b60035461010090820110613d1c576003546101000382820310613d1c57600192505b50509392505050565b60415481565b60008060305414613d7a57600080fd5b600e54600160a060020a03163314613d9157600080fd5b600254600f546026540110613da557600080fd5b5060026015819055600f54602680549254929092030360255560245490556000546040517fe17095a4000000000000000000000000000000000000000000000000000000008152600160a060020a0390911690819063e17095a490613e0e90859060040161756a565b602060405180830381600087803b158015613e2857600080fd5b505af1158015613e3c573d6000803e3d6000fd5b505050506040513d601f19601f82011682018060405250613e609190810190616d08565b600355600d63219dc4a030600561268e565b603a5481565b6029805482908110613e8657fe5b600091825260209182902060029182020180546001808301805460408051601f60001995841615610100029590950190921696909604928301879004870281018701909552818552600160a060020a0390921695509193909190830182828015613f315780601f10613f0657610100808354040283529160200191613f31565b820191906000526020600020905b815481529060010190602001808311613f1457829003601f168201915b5050505050905082565b60006001815b600f548211613f79576016548260020202600554600d540101905043811115613f6e574381039250613f7e565b600190910190613f41565b600092505b505090565b600080600554600d5401905060095483101515613fac5760165460095484030260020201613fbe565b601654600954600f5485010302600202015b8091505b50919050565b602d5481565b60165460008281526013602052604081206007015490914360029091029091011015613ffe5760025b9050613ca4565b600f546000838152601360205260409020600901546002021115614023576001613ff7565b600092915050565b614033616792565b816001141561437b576007546000908152601360209081526040918290208251610240810184528154600160a060020a0316815260018201548184015260028201548185015260038201546060820152600482015460808201526005820180548551818602810186019096528086529194929360a086019392908301828280156140dc57602002820191906000526020600020905b8154815260200190600101908083116140c8575b5050505050815260200160068201548152602001600782015481526020016008820180548060200260200160405190810160405280929190818152602001828054801561414857602002820191906000526020600020905b815481526020019060010190808311614134575b5050505050815260200160098201548152602001600a82018054806020026020016040519081016040528092919081815260200182805480156141aa57602002820191906000526020600020905b815481526020019060010190808311614196575b50505050508152602001600b820160009054906101000a9004600160a060020a0316600160a060020a0316600160a060020a03168152602001600c8201548152602001600d820180548060200260200160405190810160405280929190818152602001828054801561424557602002820191906000526020600020905b8154600160a060020a03168152600190910190602001808311614227575b50505050508152602001600e820180548060200260200160405190810160405280929190818152602001828054801561429d57602002820191906000526020600020905b815481526020019060010190808311614289575b50505050508152602001600f82018054806020026020016040519081016040528092919081815260200182805480156142ff57602002820191906000526020600020905b8154600160a060020a031681526001909101906020018083116142e1575b50505050508152602001601082015481526020016011820180548060200260200160405190810160405280929190818152602001828054801561436b57602002820191906000526020600020905b8154600160a060020a0316815260019091019060200180831161434d575b5050505050815250509050613ca4565b8160021415613ca4576008546000908152601360209081526040918290208251610240810184528154600160a060020a0316815260018201548184015260028201548185015260038201546060820152600482015460808201526005820180548551818602810186019096528086529194929360a086019392908301828280156140dc57602002820191906000526020600020908154815260200190600101908083116140c857505050505081526020016006820154815260200160078201548152602001600882018054806020026020016040519081016040528092919081815260200182805480156141485760200282019190600052602060002090815481526020019060010190808311614134575050505050815260200160098201548152602001600a82018054806020026020016040519081016040528092919081815260200182805480156141aa57602002820191906000526020600020908154815260200190600101908083116141965750505050508152602001600b820160009054906101000a9004600160a060020a0316600160a060020a0316600160a060020a03168152602001600c8201548152602001600d820180548060200260200160405190810160405280929190818152602001828054801561424557602002820191906000526020600020908154600160a060020a031681526001909101906020018083116142275750505050508152602001600e820180548060200260200160405190810160405280929190818152602001828054801561429d57602002820191906000526020600020908154815260200190600101908083116142895750505050508152602001600f82018054806020026020016040519081016040528092919081815260200182805480156142ff57602002820191906000526020600020908154600160a060020a031681526001909101906020018083116142e15750505050508152602001601082015481526020016011820180548060200260200160405190810160405280929190818152602001828054801561436b57602002820191906000526020600020908154600160a060020a0316815260019091019060200180831161434d575050505050815250509050613ca4565b60075481565b60008060008060008060008060008060005a60008d8152601360205260409020603154919b50995015156146ee57600080fd5b60108901546001146146ff57600080fd5b600160068a01541461471057600080fd5b6147198c613fce565b975087151561472b5760009a50614a43565b600288141561478857600560068a01558854600160a060020a0316600081815260126020526040812054919850101561477f57600160a060020a038716600090815260126020526040902080546000190190555b60009a50614a43565b600f5460118a01546001965060029091041080156147a95750600c89015415155b156148e15788600c01549350603d548411156147c557603d5493505b600c890154600d8a01540395508592505b8383018610156148c957600d89018054879081106147f057fe5b600091825260209091200154600e8a018054600160a060020a039092169350908790811061481a57fe5b600091825260209091200154604280548290039055604154909150600160a060020a038316906108fc908381151561484e57fe5b049081150290604051600060405180830381858888f1935050505015801561487a573d6000803e3d6000fd5b50600160a060020a0382166000908152603860209081526040822080546001818101835582855283852090910185905590810180548083018255908452919092204291015595909501946147d6565b600c890180548590039055603b805485019055600094505b8415614900576148f08c6157ad565b6148fb8c6000615ae6565b61497e565b60405160e560020a63010cee25028152600d9063219dc4a09061492a903090600c90600401617381565b602060405180830381600087803b15801561494457600080fd5b505af1158015614958573d6000803e3d6000fd5b505050506040513d601f19601f8201168201806040525061497c9190810190616ccc565b505b3a5a60438054918d03613a98019290920290039055336108fc3a5a8d03613a9801029081150290604051600060405180830381858888f193505050501580156149cb573d6000803e3d6000fd5b5060026030541415614a3e57600e54604454604154604254600160a060020a03909316926108fc9291908115156149fe57fe5b0430600160a060020a03163103039081150290604051600060405180830381858888f19350505050158015614a37573d6000803e3d6000fd5b5060006043555b60019a505b50505050505050505050919050565b601d8160058110614a5f57fe5b0154905081565b60118160028110614a7357fe5b60209182820401919006915054906101000a900460ff1681565b6000806000806000806000806000806000805a60008e8152601360205260409020600f54919c509a508e108015614ae55750601080548f908110614acd57fe5b600091825260209091200154600160a060020a031633145b1515614af057600080fd5b600160068b015414614b0157600080fd5b602e543a1115614b1057600080fd5b614b1933615677565b1515614b285760009b50615146565b6007548d14614b3a5760009b50615146565b614b438d613fce565b9850881515614b555760009b50615146565b6002891415614bb257600560068b01558954600160a060020a03166000818152601260205260408120549199501015614ba957600160a060020a038816600090815260126020526040902080546000190190555b60009b50615146565b60008054600160a060020a0316975095505b600a8a0154861015614c3357600a8a01805487908110614be057fe5b90600052602060002001549450600060126000601088815481101515614c0257fe5b6000918252602080832090910154600160a060020a0316835282019290925260400190205560019590950194614bc4565b603a546023541015614d9f57602354603a54600097500393505b600f54861015614d9f57831515614c6357614d9f565b60126000601088815481101515614c7657fe5b6000918252602080832090910154600160a060020a031683528201929092526040019020541515614d9457602380546001810182556000919091527fd57b2b5166478fd4318d2acc6cc2c704584312bdd8781b32d5d06abda57f42300186905560108054600160a060020a038916916364f3ef469189908110614cf557fe5b60009182526020909120015460175460405160e060020a63ffffffff8516028152614d2d92600160a060020a03169190600401617381565b602060405180830381600087803b158015614d4757600080fd5b505af1158015614d5b573d6000803e3d6000fd5b505050506040513d601f19601f82011682018060405250614d7f9190810190616ccc565b50601754604380549091019055600019909301925b600190950194614c4d565b600095505b8960090154861015614e355760108a60080187815481101515614dc357fe5b9060005260206000200154815481101515614dda57fe5b6000918252602080832090910154600160a060020a0316808352601290915260409091205490935060051115614e2a57600160a060020a0383166000908152601260205260409020805460010190555b600190950194614da4565b60009150614e436000615c4c565b91508180614e565750614e566001615c4c565b915060028d43604051808360001916600019168152602001828152602001925050506020604051808303816000865af1158015614e97573d6000803e3d6000fd5b5050506040513d601f19601f82011682018060405250614eba9190810190616d08565b9050600860ff60f860020a600084901a810204166011805460ff19169290910460ff1691909117905560088160011a60f860020a0260f860020a900460ff16811515614f0257fe5b6011805461ff0019166101009390920460ff169290920217905560155460021415614f39578180614f365750614f36615fb6565b91505b614f7c565b6002861015614f7c57600f54602a5410614f58576000602a555b614f656001602a54611cd4565b50602a805460019081019091559590950194614f3e565b600d8a01541515614f9f57614f908d6157ad565b614f9a8d83615ae6565b61501c565b60405160e560020a63010cee25028152600d9063219dc4a090614fc89030906004908101617381565b602060405180830381600087803b158015614fe257600080fd5b505af1158015614ff6573d6000803e3d6000fd5b505050506040513d601f19601f8201168201806040525061501a9190810190616ccc565b505b86600160a060020a031663365bfb9e6040518163ffffffff1660e060020a028152600401600060405180830381600087803b15801561505a57600080fd5b505af115801561506e573d6000803e3d6000fd5b5050505061507a6161c4565b600160108b01553a5a60438054918e03613a98019290920290039055336108fc3a5a8e03613a9801029081150290604051600060405180830381858888f193505050501580156150ce573d6000803e3d6000fd5b506002603054141561514157600e54604454604154604254600160a060020a03909316926108fc92919081151561510157fe5b0430600160a060020a03163103039081150290604051600060405180830381858888f1935050505015801561513a573d6000803e3d6000fd5b5060006043555b60019b505b505050505050505050505092915050565b600160a060020a03166000908152601260205260408120541190565b60265481565b600281565b60065481565b60035481565b600e54600160a060020a031633146151a157600080fd5b43600d908155603c60055563219dc4a030600a6123d2565b60085481565b600581565b602b54600160a060020a031681565b600754600090815260136020526040812081805a8354909250600160a060020a0316331461520057600080fd5b600c830154600d840154875101111561521857600080fd5b602e543a111561522757600080fd5b5060005b85518110156152be5782600d01868281518110151561524657fe5b6020908102919091018101518254600181018455600093845291909220018054600160a060020a031916600160a060020a039092169190911790558451600e84019086908390811061529457fe5b6020908102909101810151825460018181018555600094855292909320909201919091550161522b565b600c830154600d84015414156153505760405160e560020a63010cee25028152600d9063219dc4a0906152f8903090600290600401617381565b602060405180830381600087803b15801561531257600080fd5b505af1158015615326573d6000803e3d6000fd5b505050506040513d601f19601f8201168201806040525061534a9190810190616ccc565b506153ce565b60405160e560020a63010cee25028152600d9063219dc4a09061537a903090600b90600401617381565b602060405180830381600087803b15801561539457600080fd5b505af11580156153a8573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052506153cc9190810190616ccc565b505b3a5a3360009081526014602052604090208054919094036153ee019190910201909155506001949350505050565b603954805b60008211156127005782600160a060020a031660396001840381548110151561542657fe5b6000918252602090912060039091020154600160a060020a031614156155da5782600160a060020a03166108fc60396001850381548110151561546557fe5b9060005260206000209060030201600101549081150290604051600060405180830381858888f193505050501580156154a2573d6000803e3d6000fd5b506039805460001984019081106154b557fe5b6000918252602090912060016003909202010154604480549190910390556039805460001983019081106154e557fe5b906000526020600020906003020160396001840381548110151561550557fe5b6000918252602090912082546003909202018054600160a060020a031916600160a060020a0390921691909117815560018083015481830155600280840180546155629383860193908216156101000260001901909116046164f5565b5090505060396001820381548110151561557857fe5b6000918252602082206003909102018054600160a060020a031916815560018101829055906155aa6002830182616576565b505060398054906155bf906000198301616836565b50600160a060020a0383166000908152602860205260408120555b60001990910190615401565b602e5481565b60255481565b603b5481565b60165481565b602f5481565b602c5481565b600e54600160a060020a0316331461562157600080fd5b604051600160a060020a0383169082156108fc029083906000818181858888f19350505050158015615657573d6000803e3d6000fd5b506043805491909103905550565b60405481565b60435481565b60055481565b60008061568383615157565b15156156925760009150613fc2565b5060005460405160e060020a63ce9d9bd7028152600160a060020a0390911690819063ce9d9bd7906156c890869060040161736d565b602060405180830381600087803b1580156156e257600080fd5b505af11580156156f6573d6000803e3d6000fd5b505050506040513d601f19601f8201168201806040525061571a9190810190616ccc565b15156157295760009150613fc2565b50600192915050565b60008060008460ff1660270360040260020a86600160a060020a031681151561575757fe5b04601002915060108460ff1660270360040260020a87600160a060020a031681151561577f57fe5b0460100260ff1681151561578f57fe5b04905080820160f860020a0260f860020a9004925050509392505050565b6000818152601360205260408120601b54909190818080805b600f87015484101561583a57600f87018054859081106157e257fe5b6000918252602080832090910154600160a060020a03168083526014909152604090912054600589018054929850960195908590811061581e57fe5b90600052602060002001548501945083806001019450506157c6565b604354851115615851576037805486019055615adc565b600b870154601b54604051600160a060020a039092169181156108fc0291906000818181858888f1935050505015801561588f573d6000803e3d6000fd5b50601b54604380548290039055600b8801546040517fde99e00421493d0d0c5935ad4b7c0809921e0890edda089a7bd0d16ddaa95ba7926158d992600160a060020a031691617381565b60405180910390a1600093505b600f870154841015615a7257600f870180548590811061590257fe5b6000918252602080832090910154600160a060020a03168083526014909152604080832080549084905590519198509350879184156108fc02918591818181858888f1935050505015801561595b573d6000803e3d6000fd5b506043805483900390556040517fde99e00421493d0d0c5935ad4b7c0809921e0890edda089a7bd0d16ddaa95ba7906159979088908590617381565b60405180910390a1600587018054859081106159af57fe5b6000918252602080832090910154600160a060020a03808a168452601890925260408084205490519195509091169184156108fc02918591818181858888f19350505050158015615a04573d6000803e3d6000fd5b50604380548390039055600160a060020a0380871660009081526018602052604090819020549051948401947fde99e00421493d0d0c5935ad4b7c0809921e0890edda089a7bd0d16ddaa95ba792615a5f9216908590617381565b60405180910390a16001909301926158e6565b601a548760030154886004015403600101601954028403811515615a9257fe5b04905060405481111515615ac0576005805460280190819055603f541015615abb57603f546005555b615adc565b6005546002900460058190556006541115615adc576006546005555b5050505050505050565b600082815260136020526040902060026010820155600360068201556000600755600883905543600d55600a546001016009819055600f541015615b2a5760006009555b60016030541415615b3d57615b3d61620a565b60018215151415615bca5760405160e560020a63010cee25028152600d9063219dc4a090615b72903090601090600401617381565b602060405180830381600087803b158015615b8c57600080fd5b505af1158015615ba0573d6000803e3d6000fd5b505050506040513d601f19601f82011682018060405250615bc49190810190616ccc565b50612700565b60405160e560020a63010cee25028152600d9063219dc4a090615bf4903090600990600401617381565b602060405180830381600087803b158015615c0e57600080fd5b505af1158015615c22573d6000803e3d6000fd5b505050506040513d601f19601f82011682018060405250615c469190810190616ccc565b50505050565b60008054604554602354600160a060020a0392831692909116908390606082808060018a1415615c7c57601c5494505b841515615c8b57859850615fa9565b600f54604051908082528060200260200182016040528015615cb7578160200160208202803883390190505b509350600092508291505b84821015615e0657891515615d0957600184602384815481101515615ce357fe5b9060005260206000200154815181101515615cfa57fe5b60209081029091010152615dfb565b601d8260058110615d1657fe5b015492508383815181101515615d2857fe5b9060200190602002015160001415615dfb5760018484815181101515615d4a57fe5b602090810290910101526010805484908110615d6257fe5b60009182526020909120015460175460405160e060020a63202cc5e1028152600160a060020a039283169350918a169163202cc5e191615da791859190600401617381565b602060405180830381600087803b158015615dc157600080fd5b505af1158015615dd5573d6000803e3d6000fd5b505050506040513d601f19601f82011682018060405250615df99190810190616ccc565b505b600190910190615cc2565b600f5491505b6000821115615f85578360018303815181101515615e2657fe5b9060200190602002015160011415615f7957600f805460001990810190915560108054600160a060020a038a169263f06dc92d9291908601908110615e6757fe5b60009182526020909120015460405160e060020a63ffffffff8416028152615e9b91600160a060020a03169060040161736d565b600060405180830381600087803b158015615eb557600080fd5b505af1158015615ec9573d6000803e3d6000fd5b505050506010600f54815481101515615ede57fe5b60009182526020909120015460108054600160a060020a03909216916000198501908110615f0857fe5b9060005260206000200160006101000a815481600160a060020a030219169083600160a060020a031602179055506010600f54815481101515615f4757fe5b60009182526020909120018054600160a060020a03191690556010805490615f739060001983016165e6565b50600195505b60001990910190615e0c565b891515615f9f576000615f996023826165e6565b50615fa5565b6000601c555b8598505b5050505050505050919050565b6045546026546000918290600160a060020a03165b60008311156161a557600560126000602460018703815481101515615fec57fe5b6000918252602080832090910154600160a060020a03168352820192909252604001902054141561619957601060246001850381548110151561602b57fe5b600091825260208083209091015483546001818101865594845291909220018054600160a060020a031916600160a060020a03928316179055600f805483019055602480549294509083169163e4c1de989190600019870190811061608c57fe5b60009182526020909120015460405160e060020a63ffffffff84160281526160c091600160a060020a03169060040161736d565b600060405180830381600087803b1580156160da57600080fd5b505af11580156160ee573d6000803e3d6000fd5b50506024805490925060001981019150811061610657fe5b60009182526020909120015460248054600160a060020a0390921691600019860190811061613057fe5b60009182526020909120018054600160a060020a031916600160a060020a039290921691909117905560248054600019810190811061616b57fe5b60009182526020909120018054600160a060020a031916905560248054906161979060001983016165e6565b505b60001990920191615fcb565b60245460268190551515611dd957600060258190556015555092915050565b602f5460198054620f4240818402819004909103909155601a805480840283900490039055601b805480840283900490039055602d5490910204602d5403602d81905550565b6002603055600060158190556045548154600f54600160a060020a039283169392909116915b600082111561637b5760108054600019840190811061624b57fe5b60009182526020909120015460175460405160e060020a63202cc5e1028152600160a060020a0392831693509185169163202cc5e19161629091859190600401617381565b602060405180830381600087803b1580156162aa57600080fd5b505af11580156162be573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052506162e29190810190616ccc565b5060405160e060020a63f06dc92d028152600160a060020a0385169063f06dc92d9061631290849060040161736d565b600060405180830381600087803b15801561632c57600080fd5b505af1158015616340573d6000803e3d6000fd5b5050505060106001830381548110151561635657fe5b60009182526020909120018054600160a060020a031916905560001990910190616230565b6000600f5560265491505b60008211156164e5576024805460001984019081106163a157fe5b60009182526020909120015460175460405160e060020a63202cc5e1028152600160a060020a0392831693509185169163202cc5e1916163e691859190600401617381565b602060405180830381600087803b15801561640057600080fd5b505af1158015616414573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052506164389190810190616ccc565b5060405160e060020a63f06dc92d028152600160a060020a0385169063f06dc92d9061646890849060040161736d565b600060405180830381600087803b15801561648257600080fd5b505af1158015616496573d6000803e3d6000fd5b505050506024600183038154811015156164ac57fe5b60009182526020909120018054600160a060020a031916905560248054906164d89060001983016165e6565b5060001990910190616386565b5050600060268190556025555050565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f1061652e578054855561656a565b8280016001018555821561656a57600052602060002091601f016020900482015b8281111561656a57825482559160010191906001019061654f565b506138cc929150616862565b50805460018160011615610100020316600290046000825580601f1061659c5750612444565b601f0160209004906000526020600020908101906124449190616862565b81548183558181111561270057600202816002028360005260206000209182019101612700919061687c565b81548183558181111561270057600083815260209020612700918101908301616862565b610180604051908101604052806000600160a060020a031681526020016060815260200160608152602001600081526020016000600160a060020a0316815260200160008152602001600081526020016000600160a060020a03168152602001600081526020016060815260200160608152602001606081525090565b82805482825590600052602060002090810192821561656a579160200282015b8281111561656a5782518255916020019190600101906166a7565b8280548282559060005260206000209081019282156167025760005260206000209182015b828111156167025782548255916001019190600101906166e7565b506138cc9291506168b0565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f1061674f57805160ff191683800117855561656a565b8280016001018555821561656a579182018281111561656a5782518255916020019190600101906166a7565b604080518082019091526060808252602082015290565b610240604051908101604052806000600160a060020a03168152602001600080191681526020016000801916815260200160008152602001600081526020016060815260200160008152602001600081526020016060815260200160008152602001606081526020016000600160a060020a031681526020016000815260200160608152602001606081526020016060815260200160008152602001606081525090565b8154818355818111156127005760030281600302836000526020600020918201910161270091906168d4565b61239791905b808211156138cc5760008155600101616868565b61239791905b808211156138cc578054600160a060020a031916815560006168a76001830182616576565b50600201616882565b61239791905b808211156138cc578054600160a060020a03191681556001016168b6565b61239791905b808211156138cc578054600160a060020a03191681556000600182018190556169066002830182616576565b506003016168da565b600061691b8235617644565b9392505050565b6000601f8201831361693357600080fd5b8135616946616941826175f1565b6175ca565b9150818183526020840193506020810190508385602084028201111561696b57600080fd5b60005b838110156169975781616981888261690f565b845250602092830192919091019060010161696e565b5050505092915050565b6000601f820183136169b257600080fd5b81356169c0616941826175f1565b915081818352602084019350602081019050838560208402820111156169e557600080fd5b60005b8381101561699757816169fb8882616a99565b84525060209283019291909101906001016169e8565b6000601f82018313616a2257600080fd5b8135616a30616941826175f1565b91508181835260208401935060208101905083856020840282011115616a5557600080fd5b60005b838110156169975781616a6b8882616a99565b8452506020928301929190910190600101616a58565b600061691b8235617650565b600061691b8251617650565b600061691b8235612397565b600061691b8251612397565b6000601f82018313616ac257600080fd5b8135616ad061694182617612565b91508082526020830160208301858383011115616aec57600080fd5b611ccb83828461765b565b600061691b8235617655565b600060208284031215616b1557600080fd5b6000616b21848461690f565b949350505050565b60008060408385031215616b3c57600080fd5b6000616b48858561690f565b925050602083013567ffffffffffffffff811115616b6557600080fd5b616b7185828601616ab1565b9150509250929050565b60008060408385031215616b8e57600080fd5b6000616b9a858561690f565b9250506020616b7185828601616a99565b600080600080600060a08688031215616bc357600080fd5b6000616bcf888861690f565b9550506020616be088828901616af7565b9450506040616bf188828901616a99565b9350506060616c0288828901616a99565b9250506080616c1388828901616a99565b9150509295509295909350565b600080600060608486031215616c3557600080fd5b6000616c41868661690f565b9350506020616c5286828701616af7565b9250506040616c6386828701616af7565b9150509250925092565b60008060408385031215616c8057600080fd5b823567ffffffffffffffff811115616c9757600080fd5b616ca385828601616922565b925050602083013567ffffffffffffffff811115616cc057600080fd5b616b7185828601616a11565b600060208284031215616cde57600080fd5b6000616b218484616a8d565b600060208284031215616cfc57600080fd5b6000616b218484616a99565b600060208284031215616d1a57600080fd5b6000616b218484616aa5565b600080600080600080600060e0888a031215616d4157600080fd5b6000616d4d8a8a616a99565b975050602088013567ffffffffffffffff811115616d6a57600080fd5b616d768a828b016169a1565b965050604088013567ffffffffffffffff811115616d9357600080fd5b616d9f8a828b01616a11565b955050606088013567ffffffffffffffff811115616dbc57600080fd5b616dc88a828b01616a11565b945050608088013567ffffffffffffffff811115616de557600080fd5b616df18a828b01616a11565b93505060a0616e028a828b0161690f565b92505060c0616e138a828b01616a99565b91505092959891949750929550565b60008060408385031215616e3557600080fd5b6000616b9a8585616a99565b600080600060608486031215616e5657600080fd5b6000616e628686616a99565b9350506020616e7386828701616a99565b9250506040616c6386828701616a81565b616e8d81617644565b82525050565b6000616e9e82617640565b808452602084019350616eb08361763a565b60005b82811015616ee057616ec6868351616e84565b616ecf8261763a565b602096909601959150600101616eb3565b5093949350505050565b6000616ef582617640565b808452602084019350616f078361763a565b60005b82811015616ee057616f1d868351616e84565b616f268261763a565b602096909601959150600101616f0a565b6000616f4282617640565b80845260208401935083602082028501616f5b8561763a565b60005b84811015616f92578383038852616f7683835161704a565b9250616f818261763a565b602098909801979150600101616f5e565b50909695505050505050565b6000616fa982617640565b808452602084019350616fbb8361763a565b60005b82811015616ee057616fd1868351617041565b616fda8261763a565b602096909601959150600101616fbe565b6000616ff682617640565b8084526020840193506170088361763a565b60005b82811015616ee05761701e868351617041565b6170278261763a565b60209690960195915060010161700b565b616e8d81617650565b616e8d81612397565b600061705582617640565b808452617069816020860160208601617667565b61707281617693565b9093016020019392505050565b80516000906102408401906170948582616e84565b5060208301516170a76020860182617041565b5060408301516170ba6040860182617041565b5060608301516170cd6060860182617041565b5060808301516170e06080860182617041565b5060a083015184820360a08601526170f88282616feb565b91505060c083015161710d60c0860182617041565b5060e083015161712060e0860182617041565b5061010083015184820361010086015261713a8282616feb565b915050610120830151617151610120860182617041565b5061014083015184820361014086015261716b8282616feb565b915050610160830151617182610160860182616e84565b50610180830151617197610180860182617041565b506101a08301518482036101a08601526171b18282616eea565b9150506101c08301518482036101c08601526171cd8282616feb565b9150506101e08301518482036101e08601526171e98282616eea565b915050610200830151617200610200860182617041565b5061022083015184820361022086015261721a8282616eea565b95945050505050565b805160408084526000919084019061723b8282616feb565b9150506020830151848203602086015261721a8282616feb565b805160009061018084019061726a8582616e84565b50602083015184820360208601526172828282616feb565b9150506040830151848203604086015261729c8282616feb565b91505060608301516172b16060860182617041565b5060808301516172c46080860182616e84565b5060a08301516172d760a0860182617041565b5060c08301516172ea60c0860182617041565b5060e08301516172fd60e0860182616e84565b50610100830151617312610100860182617041565b5061012083015184820361012086015261732c8282616feb565b9150506101408301518482036101408601526173488282616eea565b91505061016083015184820361016086015261721a8282616eea565b616e8d81617655565b6020810161737b8284616e84565b92915050565b6040810161738f8285616e84565b61691b6020830184617041565b61016081016173ab828e616e84565b6173b8602083018d617041565b6173c5604083018c617041565b6173d2606083018b617041565b6173df608083018a617041565b6173ec60a0830189617041565b6173f960c0830188617041565b61740660e0830187617041565b617414610100830186616e84565b617422610120830185617041565b617430610140830184617041565b9c9b505050505050505050505050565b6040810161744e8285616e84565b8181036020830152616b21818461704a565b6060810161746e8286616e84565b61747b6020830185617041565b818103604083015261721a818461704a565b60a0810161749b8288616e84565b6174a86020830187617041565b6174b56040830186617364565b6174c26060830185617041565b6174cf6080830184617041565b9695505050505050565b6020808252810161691b8184616e93565b604080825281016174fb8185616e93565b90508181036020830152616b218184616f37565b608080825281016175208187616e93565b905081810360208301526175348186616f9e565b905081810360408301526175488185616f9e565b905081810360608301526174cf8184616f9e565b6020810161737b8284617038565b6020810161737b8284617041565b6020808252810161691b818461704a565b6020808252810161691b818461707f565b6020808252810161691b8184617223565b6020808252810161691b8184617255565b6020810161737b8284617364565b60405181810167ffffffffffffffff811182821017156175e957600080fd5b604052919050565b600067ffffffffffffffff82111561760857600080fd5b5060209081020190565b600067ffffffffffffffff82111561762957600080fd5b506020601f91909101601f19160190565b60200190565b5190565b600160a060020a031690565b151590565b60ff1690565b82818337506000910152565b60005b8381101561768257818101518382015260200161766a565b83811115615c465750506000910152565b601f01601f1916905600a265627a7a723058205b3663ce6b2f2b03e0cd5c4f217c1a7c71b662127bf59b4d9a36f47a3668bb926c6578706572696d656e74616cf50037', 
     gas: '9000000'
   }, function (e, contract){
         if (e!=null){console.log('RandDrop AppChain contract deploy error : ', e); reject(e); return}
         console.log(' AppChain Contract transactionHash: ', contract.transactionHash); 
         if (typeof(contract.address)!='undefined'){ resolve(contract.address);}    
    });
		
	})
}

// Functions to use in the process
// Send TX to AppChain with account password and Sharding Flag set
function sendAppChainTx(baseaddr,basepsd, subchainaddr, via, amount,code,n,sf)
{
    chain3.personal.unlockAccount(baseaddr,basepsd);
    txhash = chain3.mc.sendTransaction(
        {
            from: baseaddr,
            value:chain3.toSha(amount,'mc'),
            to: subchainaddr,
            gas: "0",
            gasPrice: chain3.mc.gasPrice,
            shardingFlag: sf,
            data: code,
            nonce: n,
            via: via,
        });
    return txhash;
}

// Wait for results to come
function waitForAppChainBlocks(inMcAddr, innum) {
  let startBlk = chain3.scs.getBlockNumber(inMcAddr);
  let preBlk = 0;
  // Incase the return is not valid, use 0 instead of NAN
  if ( startBlk > 0 ){
    preBlk = startBlk;
  }else{
        startBlk = 0;
  }

  console.log("Waiting for blocks to confirm the TX... currently at block " + startBlk);
  while (true) {
    let curblk = chain3.scs.getBlockNumber(inMcAddr);
    if (curblk > startBlk + innum) {
      console.log("Waited for " + innum + " blocks!");
      break;
    }
    if ( curblk > preBlk){
      console.log("Waiting for blocks to confirm the TX... currently at block " + curblk);
      preBlk = curblk;
    }else{
        console.log("...");
    }
    
    sleep(3000000);
  }
}


